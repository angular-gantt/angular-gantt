/*! angular-gantt 07-03-2014 */
var gantt=angular.module("gantt",[]);gantt.directive("gantt",["Gantt","dateFunctions","mouseOffset","debounce","keepScrollPos",function(a,b,c,d,e){return{restrict:"EA",replace:!0,templateUrl:function(a,b){return void 0===b.templateUrl?"template/gantt.tmpl.html":b.templateUrl},scope:{sortMode:"=?",viewScale:"=?",columnWidth:"=?",columnSubScale:"=?",allowTaskMoving:"=?",allowTaskResizing:"=?",allowRowSorting:"=?",fromDate:"=?",toDate:"=?",firstDayOfWeek:"=?",weekendDays:"=?",showWeekends:"=?",workHours:"=?",showNonWorkHours:"=?",autoExpand:"=?",maxHeight:"=?",labelsWidth:"=?",data:"=?",loadData:"&",removeData:"&",clearData:"&",centerDate:"&",onGanttReady:"&",onRowAdded:"&",onRowClicked:"&",onRowUpdated:"&",onScroll:"&",onTaskClicked:"&",onTaskUpdated:"&"},controller:["$scope","$element",function(f,g){void 0===f.sortMode&&(f.sortMode="name"),void 0===f.viewScale&&(f.viewScale="day"),void 0===f.columnWidth&&(f.columnWidth=2),void 0===f.columnSubScale&&(f.columnSubScale=4),void 0===f.allowTaskMoving&&(f.allowTaskMoving=!0),void 0===f.allowTaskResizing&&(f.allowTaskResizing=!0),void 0===f.allowRowSorting&&(f.allowRowSorting=!0),void 0===f.firstDayOfWeek&&(f.firstDayOfWeek=1),void 0===f.weekendDays&&(f.weekendDays=[0,6]),void 0===f.showWeekends&&(f.showWeekends=!0),void 0===f.workHours&&(f.workHours=[8,9,10,11,12,13,14,15,16]),void 0===f.showNonWorkHours&&(f.showNonWorkHours=!0),void 0===f.maxHeight&&(f.maxHeight=0),void 0===f.autoExpand&&(f.autoExpand=!1),void 0===f.labelsWidth&&(f.labelsWidth=0),f.gantt=new a(f.viewScale,f.columnWidth,f.columnSubScale,f.firstDayOfWeek,f.weekendDays,f.showWeekends,f.workHours,f.showNonWorkHours),f.gantt.expandDefaultDateRange(f.fromDate,f.toDate),f.ganttScroll=angular.element(g.children()[2]),f.$watch("sortMode",function(a,b){angular.equals(a,b)||f.sortRows()}),f.$watch("data",function(a,b){angular.equals(a,b)||(f.removeAllData(),f.setData(a))}),f.$watch("viewScale+columnWidth+columnSubScale+fromDate+toDate+firstDayOfWeek+weekendDays+showWeekends+workHours+showNonWorkHours",function(a,b){angular.equals(a,b)||(f.gantt.setViewScale(f.viewScale,f.columnWidth,f.columnSubScale,f.firstDayOfWeek,f.weekendDays,f.showWeekends,f.workHours,f.showNonWorkHours),f.gantt.reGenerateColumns())}),f.$watch("fromDate+toDate",function(a,b){angular.equals(a,b)||f.gantt.expandDefaultDateRange(f.fromDate,f.toDate)}),f.getPxToEmFactor=function(){return f.ganttScroll.children()[0].offsetWidth/f.gantt.width},f.swapRows=function(a,b){f.gantt.swapRows(a,b),f.raiseRowUpdatedEvent(a),f.raiseRowUpdatedEvent(b),"custom"!==f.sortMode?f.sortMode="custom":f.sortRows()},f.sortRows=function(){f.gantt.sortRows(f.sortMode)},f.scrollTo=function(a){f.ganttScroll[0].scrollLeft=a,f.ganttScroll.triggerHandler("scroll")},f.scrollLeft=function(a){f.ganttScroll[0].scrollLeft-=a,f.ganttScroll.triggerHandler("scroll")},f.scrollRight=function(a){f.ganttScroll[0].scrollLeft+=a,f.ganttScroll.triggerHandler("scroll")},f.scrollToDate=function(a){var b=f.gantt.getColumnByDate(a);if(void 0!==b){var c=(b.left+b.width/2)*f.getPxToEmFactor();f.ganttScroll[0].scrollLeft=c-f.ganttScroll[0].offsetWidth/2}},f.autoExpandColumns=e(f,function(a,c,d){if(f.autoExpand===!0){var e,g,h=1,i=31;"left"===d?(e="hour"===f.viewScale?b.addDays(c,-h,!0):b.addDays(c,-i,!0),g=c):(e=c,g="hour"===f.viewScale?b.addDays(c,h,!0):b.addDays(c,i,!0)),f.gantt.expandDefaultDateRange(e,g)}}),f.raiseRowAddedEvent=function(a){f.onRowAdded({event:{row:a}})},f.raiseDOMRowClickedEvent=function(a,b){var d=c.getOffset(a).x,e=d/f.getPxToEmFactor(),g=f.gantt.getColumnByPosition(e),h=f.gantt.getDateByPosition(e);f.raiseRowClickedEvent(b,g,h),a.stopPropagation(),a.preventDefault()},f.raiseRowClickedEvent=function(a,b,c){f.onRowClicked({event:{row:a,column:b.clone(),date:c}})},f.raiseRowUpdatedEvent=function(a){f.onRowUpdated({event:{row:a}})},f.raiseScrollEvent=d(function(){var a,b,c=f.ganttScroll[0];0===c.scrollLeft?(a="left",b=f.gantt.getDateRange().from):c.offsetWidth+c.scrollLeft>=c.scrollWidth&&(a="right",b=f.gantt.getDateRange().to),void 0!==b&&(f.autoExpandColumns(c,b,a),f.onScroll({event:{date:b,direction:a}}))},5),f.raiseDOMTaskClickedEvent=function(a,b){f.raiseTaskClickedEvent(b),a.stopPropagation(),a.preventDefault()},f.raiseTaskClickedEvent=function(a){f.onTaskClicked({event:{task:a}})},f.raiseTaskUpdatedEvent=function(a){f.onTaskUpdated({event:{task:a}})},f.setData=e(f,function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b],e=f.gantt.addRow(d),g=f.gantt.rowsMap[d.id];e===!0?f.raiseRowUpdatedEvent(g):f.raiseRowAddedEvent(g)}f.sortRows()}),f.removeData({fn:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];if(void 0!==d.tasks&&d.tasks.length>0){if(d.id in f.gantt.rowsMap){for(var e=f.gantt.rowsMap[d.id],g=0,h=d.tasks.length;h>g;g++)e.removeTask(d.tasks[g].id);f.raiseRowUpdatedEvent(e)}}else f.gantt.removeRow(d.id)}f.sortRows()}}),f.removeAllData=function(){f.gantt.removeRows()},f.ganttScroll.bind("scroll",f.raiseScrollEvent),f.loadData({fn:f.setData}),f.clearData({fn:f.removeAllData}),f.centerDate({fn:f.scrollToDate}),f.onGanttReady()}]}}]),gantt.factory("Column",["dateFunctions",function(a){var b=function(a,b,c){return Math.round(b/a.width*c/(b/a.subScale))*(b/a.subScale)},c=function(a,b,c,d,e,f){var g;return g=b-a.date>0&&e!==f?1:Math.round(d/c*a.subScale)/a.subScale,Math.round(10*(a.left+a.width*g))/10},d=function(a,b,c,e){var f=this;f.date=a,f.left=b,f.width=c,f.subScale=e,f.clone=function(){return new d(f.date,f.left,f.width,f.subScale)},f.equals=function(a){return f.date===a.date}},e=function(e,f,g,h){var i=new d(e,f,g,h);return i.daysInMonth=a.getDaysInMonth(i.date),i.clone=function(){return new d(i.date,i.left,i.width,i.subScale)},i.getDateByPosition=function(c){0>c&&(c=0),c>i.width&&(c=i.width);var d=a.clone(i.date);return d.setDate(1+b(i,i.daysInMonth,c)),d},i.getPositionByDate=function(a){return c(i,a,i.daysInMonth,a.getDate(),a.getMonth(),i.date.getMonth())},i},f=function(e,f,g,h,i){var j=new d(e,f,g,h);j.week=a.getWeek(e),j.firstDayOfWeek=i,j.daysInWeek=7,j.clone=function(){var a=new d(j.date,j.left,j.width,j.subScale);return a.week=j.week,a};var k=function(a){return(j.daysInWeek-j.firstDayOfWeek+a)%j.daysInWeek},l=function(a){return(j.firstDayOfWeek+a)%j.daysInWeek};return j.getDateByPosition=function(c){0>c&&(c=0),c>j.width&&(c=j.width);var d=a.clone(j.date),e=Math.round(b(j,j.daysInWeek,c)),f=7!==e&&e<j.firstDayOfWeek?-1:1;return a.setToDayOfWeek(d,7!==e?l(e):l(e)+7,!1,f),d},j.getPositionByDate=function(b){return c(j,b,j.daysInWeek,k(b.getDay()),a.getWeek(b),a.getWeek(j.date))},j},g=function(e,f,g,h,i,j,k,l,m){var n=new d(e,f,g,h);n.isWeekend=i,n.daysToNextWorkingDay=j,n.daysToPrevWorkingDay=k,n.showNonWorkHours=m;var o=0,p=24;return 9==arguments.length&&!m&&l.length>1&&(o=l[0],p=l[l.length-1]+1),n.clone=function(){var a=new d(n.date,n.left,n.width,n.subScale);return a.isWeekend=n.isWeekend,a},n.getDateByPosition=function(c,d){0>c&&(c=0),c>n.width&&(c=n.width);var e=a.clone(n.date),f=o+b(n,p-o,c);return 2==arguments.length&&(f==p&&d?(e=a.addDays(e,n.daysToNextWorkingDay),f=o):f!=o||d||(e=a.addDays(e,-n.daysToPrevWorkingDay),f=p)),e.setHours(f),e},n.getPositionByDate=function(b){if(a.setTimeZero(b,!0)>a.setTimeZero(n.date,!0))return n.left+n.width;var d=p-o,e=b.getHours()-o;return 0>e?n.left:e>d?n.left+n.width:c(n,b,d,e,b.getDate(),n.date.getDate())},n},h=function(e,f,g,h,i,j){var k=new d(e,f,g,h);return k.isWeekend=i,k.isWorkHour=j,k.clone=function(){var a=new d(k.date,k.left,k.width,k.subScale);return a.isWeekend=k.isWeekend,a.isWorkHour=k.isWorkHour,a},k.getDateByPosition=function(c){0>c&&(c=0),c>k.width&&(c=k.width);var d=a.clone(k.date);return d.setMinutes(b(k,60,c)),d},k.getPositionByDate=function(a){return c(k,a,60,a.getMinutes(),a.getHours(),k.date.getHours())},k};return{Hour:h,Day:g,Week:f,Month:e}}]),gantt.factory("ColumnGenerator",["Column","dateFunctions",function(a,b){var c=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return!0;return!1},d=function(a,b){for(var d=1;8>d;d++){var e=(b+d)%7;if(!c(a,e))return d}return 1},e=function(a,b){for(var d=1;8>d;d++){var e=((b-d)%7+7)%7;if(!c(a,e))return d}return 1},f=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return!0;return!1},g=function(d,e,g,h,i,j){this.generate=function(k,l){var m=b.isTimeZero(l);k=b.setTimeZero(k,!0),l=b.setTimeZero(l,!0);for(var n=b.clone(k),o=[],p=0;m&&l-n>0||!m&&l-n>=0;){for(var q=c(g,n.getDay()),r=0;24>r;r++){var s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),r,0,0),t=f(i,r);(q&&h||!q)&&(!t&&j||t)&&(o.push(new a.Hour(s,p,d,e,q,t)),p+=d)}n=b.addDays(n,1)}return o}},h=function(f,g,h,i,j,k){this.generate=function(l,m){var n=b.isTimeZero(m);l=b.setTimeZero(l,!0),m=b.setTimeZero(m,!0);for(var o=b.clone(l),p=[],q=0;n&&m-o>0||!n&&m-o>=0;){var r=c(h,o.getDay()),s=1,t=1;i||(s=d(h,o.getDay()),t=e(h,o.getDay())),(r&&i||!r)&&(p.push(new a.Day(b.clone(o),q,f,g,r,s,t,j,k)),q+=f),o=b.addDays(o,1)}return p}},i=function(c,d,e){this.generate=function(f,g){var h=g.getDay()===e&&b.isTimeZero(g);f=b.setToDayOfWeek(b.setTimeZero(f,!0),e,!1),g=b.setToDayOfWeek(b.setTimeZero(g,!0),e,!1);for(var i=b.clone(f),j=[],k=0;h&&g-i>0||!h&&g-i>=0;)j.push(new a.Week(b.clone(i),k,c,d,e)),k+=c,i=b.addWeeks(i,1);return j}},j=function(c,d){this.generate=function(e,f){var g=1===f.getDate()&&b.isTimeZero(f);e=b.setToFirstDayOfMonth(b.setTimeZero(e,!0),!1),f=b.setToFirstDayOfMonth(b.setTimeZero(f,!0),!1);for(var h=b.clone(e),i=[],j=0;g&&f-h>0||!g&&f-h>=0;)i.push(new a.Month(b.clone(h),j,c,d)),j+=c,h=b.addMonths(h,1);return i}};return{HourGenerator:g,DayGenerator:h,WeekGenerator:i,MonthGenerator:j}}]),gantt.factory("Gantt",["Row","ColumnGenerator","HeaderGenerator","dateFunctions","binarySearch",function(a,b,c,d,e){var f=function(f,g,h,i,j,k,l,m){var n=this;n.rowsMap={},n.rows=[],n.columns=[],n.headers={},n.width=0;var o;n.setViewScale=function(a,d,e,f,g,h,i,j){switch(a){case"hour":n.columnGenerator=new b.HourGenerator(d,e,g,h,i,j);break;case"day":n.columnGenerator=new b.DayGenerator(d,e,g,h,i,j);break;case"week":n.columnGenerator=new b.WeekGenerator(d,e,f);break;case"month":n.columnGenerator=new b.MonthGenerator(d,e);break;default:throw"Unsupported view scale: "+a}n.headerGenerator=new c.instance(a)},n.setViewScale(f,g,h,i,j,k,l,m),n.expandDefaultDateRange=function(a,b){void 0!==a&&void 0!==b&&(p(a,b),q())};var p=function(a,b){a=d.clone(a),b=d.clone(b),void 0===o?(o={},o.from=a,o.to=b):(a<o.from&&(o.from=a),b>o.to&&(o.to=b))},q=function(){if(void 0===o)throw"From and to date range cannot be undefined";if(0===n.columns.length)r(o.from,o.to);else if(n.getFirstColumn().date>o.from||n.getLastColumn().date<o.to){var a=n.getFirstColumn().date>o.from?o.from:n.getFirstColumn().date,b=n.getLastColumn().date<o.to?o.to:n.getLastColumn().date;r(a,b)}},r=function(a,b){n.columns=n.columnGenerator.generate(a,b),n.headers=n.headerGenerator.generate(n.columns),n.updateTasksPosAndSize();var c=n.getLastColumn();n.width=void 0!==c?c.left+c.width:0};n.reGenerateColumns=function(){n.columns=[],q()},n.updateTasksPosAndSize=function(){for(var a=0,b=n.rows.length;b>a;a++)for(var c=0,d=n.rows[a].tasks.length;d>c;c++)n.rows[a].tasks[c].updatePosAndSize()},n.getLastColumn=function(){return n.columns.length>0?n.columns[n.columns.length-1]:void 0},n.getFirstColumn=function(){return n.columns.length>0?n.columns[0]:void 0},n.getColumnByDate=function(a){return e.get(n.columns,a,function(a){return a.date})[0]},n.getColumnByPosition=function(a){return e.get(n.columns,a,function(a){return a.left})[0]},n.getDateByPosition=function(a,b){var c=n.getColumnByPosition(a);return void 0!==c?2==arguments.length?c.getDateByPosition(a-c.left,b):c.getDateByPosition(a-c.left):void 0},n.getPositionByDate=function(a){var b=n.getColumnByDate(a);return void 0!==b?b.getPositionByDate(a):void 0},n.getDateRange=function(){return void 0===o?void 0:{from:d.clone(o.from),to:d.clone(o.to)}},n.getTasksDateRange=function(){if(0===n.rows.length)return void 0;for(var a,b,c=0,d=n.rows.length;d>c;c++){var e=n.rows[c];(void 0===a||e.minFromDate<a)&&(a=e.minFromDate),(void 0===b||e.maxToDate>b)&&(b=e.maxToDate)}return{from:a,to:b}},n.getActiveHeadersCount=function(){var a,b=0;for(a in n.headers)n.headers.hasOwnProperty(a)&&b++;return b},n.addRow=function(b){var c,d=!1;if(b.id in n.rowsMap)c=n.rowsMap[b.id],c.copy(b),d=!0;else{var e=b.order;void 0===e&&(e=n.highestRowOrder),e>=n.highestRowOrder&&(n.highestRowOrder=e+1),c=new a(b.id,n,b.description,e,b.data),n.rowsMap[b.id]=c,n.rows.push(c)}if(void 0!==b.tasks&&b.tasks.length>0){for(var f=0,g=b.tasks.length;g>f;f++){var h=c.addTask(b.tasks[f]);p(h.from,h.to),h.updatePosAndSize()}q()}return d},n.removeRow=function(a){if(a in n.rowsMap){delete n.rowsMap[a];for(var b=0,c=n.rows.length;c>b;b++){var d=n.rows[b];if(d.id===a)return n.rows.splice(b,1),d}}return void 0},n.removeRows=function(){n.rowsMap={},n.rows=[],n.highestRowOrder=0,n.columns=[],o=void 0},n.swapRows=function(a,b){var c=a.order;a.order=b.order,b.order=c};var s=function(a,b){return void 0===a.minFromDate&&void 0===b.minFromDate?t(a,b):void 0===a.minFromDate?1:void 0===b.minFromDate?-1:a.minFromDate-b.minFromDate},t=function(a,b){return a.description===b.description?0:a.description<b.description?-1:1},u=function(a,b){return void 0===a.order&&void 0===b.order?t(a,b):void 0===a.order?1:void 0===b.order?-1:a.order-b.order};n.sortRows=function(a){switch(a){case"name":n.rows.sort(t);break;case"custom":n.rows.sort(u);break;default:n.rows.sort(s)}}};return f}]),gantt.factory("HeaderGenerator",["Column","dateFunctions",function(a,b){var c=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getHours()!==h.date.getHours()?(d=new a.Hour(b.clone(h.date),h.left,h.width,h.isWeekend,h.isWorkHour),e.push(d)):d.width+=h.width}return e},d=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getDay()!==h.date.getDay()?(d=new a.Day(b.clone(h.date),h.left,h.width,h.isWeekend,h.daysToNextWorkingDay,h.daysToPrevWorkingDay),e.push(d)):d.width+=h.width}return e},e=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||b.getWeek(c[f-1].date)!==b.getWeek(h.date)?(d=new a.Week(b.clone(h.date),h.left,h.width,b.getWeek(h.date)),e.push(d)):d.width+=h.width}return e},f=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getMonth()!==h.date.getMonth()?(d=new a.Month(b.clone(h.date),h.left,h.width),e.push(d)):d.width+=h.width}return e};return{instance:function(a){this.generate=function(b){var g={};switch(a){case"hour":g.hour=c(b),g.day=d(b);break;case"day":g.day=d(b),g.week=e(b),g.month=f(b);break;case"week":g.week=e(b),g.month=f(b);break;case"month":g.month=f(b);break;default:throw"Unsupported view scale: "+a}return g}}}}]),gantt.factory("Row",["Task","dateFunctions",function(a,b){var c=function(d,e,f,g,h){var i=this;i.id=d,i.gantt=e,i.description=f,i.order=g,i.tasksMap={},i.tasks=[],i.data=h,i.addTask=function(b){var c;return b.id in i.tasksMap?(c=i.tasksMap[b.id],c.copy(b)):(c=new a(b.id,i,b.subject,b.color,b.from,b.to,b.data,b.est,b.lct),i.tasksMap[b.id]=c,i.tasks.push(c)),i.sortTasks(),i.setMinMaxDateByTask(c),c},i.moveTaskToRow=function(a){a.row.removeTask(a.id),i.tasksMap[a.id]=a,i.tasks.push(a),i.setTasksMinMaxDate(),a.row=i,a.updatePosAndSize()},i.removeTask=function(a){if(a in i.tasksMap){delete i.tasksMap[a];for(var b=0,c=i.tasks.length;c>b;b++){var d=i.tasks[b];if(d.id===a)return i.tasks.splice(b,1),(i.minFromDate-d.from===0||i.maxToDate-d.to===0)&&i.setTasksMinMaxDate(),d}}},i.setTasksMinMaxDate=function(){i.minFromDate=void 0,i.maxToDate=void 0;for(var a=0,b=i.tasks.length;b>a;a++)i.setMinMaxDateByTask(i.tasks[a])},i.setMinMaxDateByTask=function(a){void 0===i.minFromDate?i.minFromDate=b.clone(a.from):a.from<i.minFromDate&&(i.minFromDate=b.clone(a.from)),void 0===i.maxToDate?i.maxToDate=b.clone(a.to):a.to>i.maxToDate&&(i.maxToDate=b.clone(a.to))},i.sortTasks=function(){i.tasks.sort(function(a,b){return a.left-b.left})},i.copy=function(a){i.description=a.description,i.data=a.data,void 0!==a.order&&(i.order=a.order)},i.clone=function(){for(var a=new c(i.id,i.gantt,i.description,i.order,i.data),b=0,d=i.tasks.length;d>b;b++)a.addTask(i.tasks[b].clone());return a}};return c}]),gantt.factory("Task",["dateFunctions",function(a){var b=function(c,d,e,f,g,h,i,j,k){var l=this;l.id=c,l.gantt=d.gantt,l.row=d,l.subject=e,l.color=f,l.from=a.clone(g),l.to=a.clone(h),l.data=i,void 0!==j&&void 0!==k&&(l.est=a.clone(j),l.lct=a.clone(k)),l.checkIfMilestone=function(){l.isMilestone=l.from-l.to===0},l.checkIfMilestone(),l.updatePosAndSize=function(){l.left=l.gantt.getPositionByDate(l.from),l.width=Math.round(10*(l.gantt.getPositionByDate(l.to)-l.left))/10,void 0!==l.est&&void 0!==l.lct&&(l.bounds={},l.bounds.left=l.gantt.getPositionByDate(l.est),l.bounds.width=Math.round(10*(l.gantt.getPositionByDate(l.lct)-l.bounds.left))/10)},l.setFrom=function(a){a>l.left+l.width?a=l.left+l.width:0>a&&(a=0),l.from=l.gantt.getDateByPosition(a,!0),l.row.setMinMaxDateByTask(l),l.updatePosAndSize(),l.checkIfMilestone()},l.setTo=function(a){a<l.left?a=l.left:a>l.gantt.width&&(a=l.gantt.width),l.to=l.gantt.getDateByPosition(a,!1),l.row.setMinMaxDateByTask(l),l.updatePosAndSize(),l.checkIfMilestone()},l.moveTo=function(a){0>a?a=0:a+l.width>=l.gantt.width&&(a=l.gantt.width-l.width),l.from=l.gantt.getDateByPosition(a,!0),l.left=l.gantt.getPositionByDate(l.from),l.to=l.gantt.getDateByPosition(l.left+l.width,!1),l.width=Math.round(10*(l.gantt.getPositionByDate(l.to)-l.left))/10,l.row.setMinMaxDateByTask(l)},l.copy=function(b){l.subject=b.subject,l.color=b.color,l.from=a.clone(b.from),l.to=a.clone(b.to),l.est=a.clone(b.est),l.lct=a.clone(b.lct),l.data=b.data,l.isMilestone=b.isMilestone},l.clone=function(){return new b(l.id,l.row,l.subject,l.color,l.from,l.to,l.data,l.est,l.lct)}};return b}]),gantt.service("binarySearch",[function(){return{getIndicesOnly:function(a,b,c){for(var d=-1,e=a.length;e-d>1;){var f=Math.floor((d+e)/2);c(a[f])<=b?d=f:e=f}return void 0!==a[d]&&c(a[d])===b&&(e=d),[d,e]},get:function(a,b,c){var d=this.getIndicesOnly(a,b,c);return[a[d[0]],a[d[1]]]}}}]),gantt.service("dateFunctions",[function(){return{isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isString:function(a){return"string"==typeof a||"object"==typeof a&&a.constructor===String},clone:function(a){return new Date(this.isString(a)?Date.parse(a):this.isNumber(a)?a:a.getTime())},setTimeZero:function(a,b){var c=b===!0?this.clone(a):a;return c.setHours(0),c.setMinutes(0),c.setMilliseconds(0),c},setTimeComponent:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,b)},setToFirstDayOfMonth:function(a,b){var c=b===!0?this.clone(a):a;return c.setDate(1),c},setToDayOfWeek:function(a,b,c,d){var e=c===!0?this.clone(a):a;if(e.getDay()===b)return e;d=d||-1;var f=(b-e.getDay()+7*(d||1))%7;return this.addDays(e,0===f?f+=7*(d||1):f)},addMonths:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(1),d.setMonth(d.getMonth()+b),d},addWeeks:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+7*b),d},addDays:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+b),d},addHours:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setHours(d.getHours()+b),d},addMinutes:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMinutes(d.getMinutes()+b),d},addMilliseconds:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMilliseconds(d.getMilliseconds()+b),d},isTimeZero:function(a){return 0===a.getHours()&&0===a.getMinutes()&&0===a.getMinutes()&&0===a.getMilliseconds()},getDaysInMonth:function(a){return new Date(a.getYear(),a.getMonth()+1,0).getDate()},getWeek:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),2>=c?(e=b-1,f=(e/4|0)-(e/100|0)+(e/400|0),g=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),m=f-g,i=0,j=d-1+31*(c-1)):(e=b,f=(e/4|0)-(e/100|0)+(e/400|0),g=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),m=f-g,i=m+1,j=d+(153*(c-3)+2)/5+58+m),k=(e+f)%7,h=(j+k-i)%7,l=j+3-h|0,n=0>l?53-((k-m)/5|0):l>364+m?1:(l/7|0)+1,b=c=d=null,n}}}]),gantt.directive("ganttBounds",[function(){return{restrict:"E",template:"<div ng-if='visible' class='gantt-task-bounds' ng-style='getCss()' ng-class='getClass()'></div>",replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(a){var b={};void 0!==a.task.bounds?b.width=a.task.bounds.width+"em":b.display="none",a.getCss=function(){return void 0!==a.task.bounds&&(b.left=a.task.isMilestone===!0||0===a.task.width?a.task.bounds.left-(a.task.left-.3)+"em":a.task.bounds.left-a.task.left+"em"),b},a.getClass=function(){return void 0===a.task.est||void 0===a.task.lct?"gantt-task-bounds-in":a.task.est>a.task.from?"gantt-task-bounds-out":a.task.lct<a.task.to?"gantt-task-bounds-out":"gantt-task-bounds-in"},a.$watch("task.mouseOver",function(){return a.task.isMoving?!0:void(a.visible=void 0===a.task.mouseOver||a.task.mouseOver===!1?!1:!0)}),a.$watch("task.isMoving",function(b){a.visible=b===!0?!0:!1})}]}}]),gantt.filter("ganttColumnLimit",["binarySearch",function(a){return function(b,c,d){var e=function(a){return a.left},f=a.getIndicesOnly(b,c,e)[0],g=a.getIndicesOnly(b,c+d,e)[1];return b.slice(f,g)}}]),gantt.directive("ganttLimitUpdater",["$timeout",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){var d=c[0],e=function(){b.scroll_start=d.scrollLeft/b.getPxToEmFactor(),b.scroll_width=d.offsetWidth/b.getPxToEmFactor()};c.bind("scroll",function(){b.$apply(function(){e()})}),b.$watch("gantt.width",function(){a(function(){e()},20,!0)})}]}}]),gantt.filter("ganttTaskLimit",[function(){return function(a,b,c){for(var d=[],e=0,f=a.length;f>e;e++){var g=a[e];(g.left>=b&&g.left<=b+c||g.left+g.width>=b&&g.left+g.width<=b+c||g.left<b&&g.left+g.width>b+c)&&d.push(g)}return d}}]),gantt.directive("ganttLabelResizable",["$document","debounce","mouseOffset",function(a,b,c){return{restrict:"A",scope:{width:"=ganttLabelResizable",minWidth:"=resizeMin"},controller:["$scope","$element",function(d,e){var f,g=5,h="ew-resize";e.bind("mousedown",function(a){j(a)&&(k(a),a.preventDefault())}),e.bind("mousemove",function(a){j(a)?e.css("cursor",h):e.css("cursor","")});var i=function(a){0===d.width&&(d.width=e[0].offsetWidth),d.width+=a-f,d.width<d.minWidth&&(d.width=d.minWidth),f=a},j=function(a){var b=c.getOffset(a).x;return b>e[0].offsetWidth-g},k=function(c){f=c.screenX,angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:h});var d=b(function(a){i(a.screenX)},5);angular.element(a[0].body).bind("mousemove",d),angular.element(a[0].body).one("mouseup",function(){angular.element(a[0].body).unbind("mousemove",d),l()})},l=function(){e.css("cursor",""),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""})}}]}}]),gantt.directive("ganttTaskMoveable",["$document","$timeout","debounce","dateFunctions","mouseOffset",function(a,b,c,d,e){return{restrict:"A",controller:["$scope","$element",function(d,f){var g,h,i,j=5,k=3,l=15,m=1,n=angular.element(a[0].body),o=f.parent().parent(),p=o.parent().parent(),q=!1;f.bind("mousedown",function(a){var b=w(a);""!==b&&(y(b,a),a.preventDefault())}),f.bind("mousemove",function(a){var b=w(a);""!==b&&"M"!==b?f.css("cursor",x(b)):f.css("cursor","")});var r=function(a,b){d.task.isMoving!==!1&&(s(a,b),t(a,b))},s=function(a,b){var c=b.x/d.getPxToEmFactor();if("M"===a){var e=v(b.y);void 0!==e&&d.task.row.id!==e.id&&e.moveTaskToRow(d.task),d.task.moveTo(c-g)}else"E"===a?d.task.setTo(c):d.task.setFrom(c);q=!0},t=function(a,c){var e=p[0].scrollLeft;if(c.x<h)c.x<=e+m&&(c.x-=l,d.scrollLeft(l),i=b(function(){r(a,c)},100,!0));else{var f=p[0].offsetWidth,g=e+f;c.x>=g-m&&(c.x+=l,d.scrollRight(l),i=b(function(){r(a,c)},100,!0))}},u=function(){void 0!==i&&(b.cancel(i),i=void 0)},v=function(a){var b=o[0].offsetHeight/d.task.row.gantt.rows.length,c=Math.floor(a/b);return d.task.row.gantt.rows[c]},w=function(a){var b=e.getOffset(a).x,c=0;return d.allowTaskResizing&&(c=f[0].offsetWidth<10?k:j),d.allowTaskResizing&&b>f[0].offsetWidth-c?"E":d.allowTaskResizing&&c>b?"W":d.allowTaskMoving&&b>=c&&b<=f[0].offsetWidth-c?"M":""},x=function(a){switch(a){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},y=function(b,f){d.task.isMoving=!0,h=e.getOffsetForElement(o[0],f).x;var i=h/d.getPxToEmFactor();g=i-d.task.left,angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:x(b)});var j=c(function(a){var c=e.getOffsetForElement(o[0],a);u(),r(b,c)},5);n.bind("mousemove",j),n.one("mouseup",function(){n.unbind("mousemove",j),z()})},z=function(){d.task.isMoving=!1,u(),q===!0&&(d.task.row.sortTasks(),d.raiseTaskUpdatedEvent(d.task),q=!1),f.css("cursor",""),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""})}}]}}]),gantt.directive("ganttHorizontalScrollReceiver",["scrollManager",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.horizontal.push(c[0])}]}}]),gantt.service("scrollManager",[function(){return{vertical:[],horizontal:[]}}]),gantt.directive("ganttScrollSender",["scrollManager","$timeout",function(a,b){return{restrict:"A",controller:["$scope","$element",function(c,d){var e=d[0],f=function(){var b,c;for(b=0,c=a.vertical.length;c>b;b++){var d=a.vertical[b];d.style.top!==-e.scrollTop&&(d.style.top=-e.scrollTop+"px")}for(b=0,c=a.horizontal.length;c>b;b++){var f=a.horizontal[b];f.style.left!==-e.scrollLeft&&(f.style.left=-e.scrollLeft+"px")}};d.bind("scroll",f),c.$watch("gantt.width",function(a){0===a&&b(function(){f()},20,!0)})}]}}]),gantt.directive("ganttVerticalScrollReceiver",["scrollManager",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.vertical.push(c[0])}]}}]),gantt.service("sortManager",[function(){return{startRow:void 0}}]),gantt.directive("ganttSortable",["$document","sortManager",function(a,b){return{restrict:"E",template:"<div ng-transclude></div>",replace:!0,transclude:!0,scope:{row:"=ngModel",swap:"&",active:"=?"},controller:["$scope","$element",function(c,d){d.bind("mousedown",function(){if(c.active===!0){f();var b=function(){c.$apply(function(){angular.element(a[0].body).unbind("mouseup",b),g()})};angular.element(a[0].body).bind("mouseup",b)}}),d.bind("mousemove",function(d){if(e()){var f=angular.element(a[0].elementFromPoint(d.clientX,d.clientY)),g=f.controller("ngModel").$modelValue;c.$apply(function(){c.swap({a:g,b:b.startRow})})}});var e=function(){return void 0!==b.startRow&&!angular.equals(c.row,b.startRow)},f=function(){b.startRow=c.row,d.css("cursor","move"),angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"no-drop"})},g=function(){b.startRow=void 0,d.css("cursor","pointer"),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:"auto"})}}]}}]),gantt.directive("ganttTooltip",["$timeout","$document","debounce","smartEvent",function(a,b,c,d){return{restrict:"E",template:"<div ng-mouseenter='mouseEnter($event)' ng-mouseleave='mouseLeave($event)'><div ng-if='visible' class='gantt-task-info' ng-style='css'><div class='gantt-task-info-content'>{{ task.subject }}</br><small>{{ task.isMilestone === true && (task.from | date:'MMM d, HH:mm') || (task.from | date:'MMM d, HH:mm') + ' - ' + (task.to | date:'MMM d, HH:mm') }}</small></div></div><div ng-transclude></div></div>",replace:!0,transclude:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(e,f){var g=angular.element(b[0].body);e.visible=!1,e.css={},e.mouseEnter=function(a){e.task.isMoving||j(a.clientX)},e.mouseLeave=function(){e.task.isMoving||l()};var h=d(e,g,"mousemove",c(function(a){e.visible===!0?k(a.clientX):j(a.clientX)},1));e.$watch("task.isMoving",function(a){a===!0?h.bind():a===!1&&(h.unbind(),l())});var i=function(){var a=b[0];return a.documentElement.clientWidth||a.documentElement.getElementById("body")[0].clientWidth},j=function(b){e.visible=!0,a(function(){var a=angular.element(f.children()[0]);k(b),e.css.top=f[0].getBoundingClientRect().top+"px",e.css.marginTop=-a[0].offsetHeight-8+"px",e.css.opacity=1},1,!0)},k=function(a){var b=angular.element(f.children()[0]);b.removeClass("gantt-task-infoArrow"),b.removeClass("gantt-task-infoArrowR"),a+b[0].offsetWidth>i()?(e.css.left=a+20-b[0].offsetWidth+"px",b.addClass("gantt-task-infoArrowR")):(e.css.left=a-20+"px",b.addClass("gantt-task-infoArrow"))},l=function(){e.css.opacity=0,e.visible=!1}}]}}]),gantt.factory("debounce",["$timeout",function(a){function b(b,c){var d=0;return function(){var e=this,f=arguments;d++;var g=function(a){return function(){return a===d?b.apply(e,f):void 0}}(d);return a(g,c,!0)}}return b}]),gantt.factory("keepScrollPos",["$timeout",function(a){function b(b,c){return function(){var d=b.ganttScroll[0],e=d.scrollLeft,f=b.gantt.getFirstColumn(),g=b.getPxToEmFactor();c.apply(this,arguments),f=void 0===f?0:b.gantt.getColumnByDate(f.date).left*g,d.scrollLeft=f+e,d.scrollLeft!=f+e&&a(function(){d.scrollLeft=f+e},0,!1)}}return b}]),gantt.service("mouseOffset",[function(){return{getOffset:function(a){return a.layerX&&a.layerY?{x:a.layerX,y:a.layerY}:a.offsetX&&a.offsetY?{x:a.offsetX,y:a.offsetY}:this.getOffsetForElement(a.target,a)},getOffsetForElement:function(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}}}]),gantt.factory("smartEvent",[function(){function a(a,b,c,d){return a.$on("$destroy",function(){b.unbind(c,d)}),{bindOnce:function(){b.one(c,d)},bind:function(){b.bind(c,d)},unbind:function(){b.unbind(c,d)}}}return a}]);