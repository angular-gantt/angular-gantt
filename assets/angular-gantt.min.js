/*! angular-gantt 11-06-2014 */
angular.module("templates.gantt",["template/default.bouds.tmpl.html","template/default.tooltip.tmpl.html","template/gantt.task.drag.tmpl.html","template/gantt.task.tmpl.html","template/gantt.tmpl.html"]),angular.module("template/default.bouds.tmpl.html",[]).run(["$templateCache",function(a){a.put("template/default.bouds.tmpl.html","<div ng-show='visible' class='gantt-task-bounds' ng-style='getCss()' ng-class='getClass()'></div>")}]),angular.module("template/default.tooltip.tmpl.html",[]).run(["$templateCache",function(a){a.put("template/default.tooltip.tmpl.html",'<div class="gantt-task-info" ng-style="css">\n    <div class="gantt-task-info-content">\n        {{ task.subject }}</br>\n        <small>\n'+"            {{ task.isMilestone === true && (task.from | date:'MMM d, HH:mm') || (task.from | date:'MMM d, HH:mm') + ' - ' + (task.to | date:'MMM d, HH:mm') }}\n        </small>\n    </div>\n</div>")}]),angular.module("template/gantt.task.drag.tmpl.html",[]).run(["$templateCache",function(a){a.put("template/gantt.task.drag.tmpl.html",'<div data-drag="true" data-jqyoui-options="jqyouiOptions" ng-model="taskToDrag" jqyoui-draggable="{onStart:\'onStart\', onStop :\'onStop\'}">\n    <div class="btn btn-default"  ng-if="!dragActive">{{task.subject}}</div>\n    <div ng-if="dragActive" ng-class="(task.isMilestone === true && [\'gantt-task-milestone\'] || [\'gantt-task\']).concat(task.classes)"\n         ng-style="{\'height\': \'1.6em\', \'width\': task.width +\'em\', \'z-index\': 1000, \'background-color\': task.color}">\n        <!--<gantt-bounds template-url="template/default.bouds.tmpl.html" ng-if="task.bounds !== undefined" ng-model="task"></gantt-bounds>-->\n        <!--<gantt-tooltip template-url="template/default.tooltip.tmpl.html" ng-if="showTooltips && (task.isMouseOver || task.isMoving)" ng-model="task"></gantt-tooltip>-->\n        <div class="gantt-task-content"><span>{{ (task.isMilestone === true && \'&nbsp;\' || task.subject) }}</span><span ng-if="task.over"> - OVER</span></div>\n    </div>\n</div>\n\n')}]),angular.module("template/gantt.task.tmpl.html",[]).run(["$templateCache",function(a){a.put("template/gantt.task.tmpl.html","<div ng-class=\"(task.isMilestone === true && ['gantt-task-milestone'] || ['gantt-task']).concat(task.classes)\"\n     ng-style=\"{'left': ((task.isMilestone === true || task.width === 0) && (task.left-0.3) || task.left)+'em', 'width': task.width +'em', 'z-index': (task.isMoving === true && 1  || task.priority || ''), 'background-color': task.color}\">\n"+'    <gantt-bounds template-url="template/default.bouds.tmpl.html" ng-if="task.bounds !== undefined" ng-model="task"></gantt-bounds>\n    <gantt-tooltip template-url="template/default.tooltip.tmpl.html" ng-if="showTooltips && (task.isMouseOver || task.isMoving)" ng-model="task"></gantt-tooltip>\n    <div class="gantt-task-content"><span>{{ (task.isMilestone === true && \'&nbsp;\' || task.subject) }}</span></div>\n</div>')}]),angular.module("template/gantt.tmpl.html",[]).run(["$templateCache",function(a){a.put("template/gantt.tmpl.html",'<div class="gantt">\n    <div class="gantt-labels"\n         ng-style="(labelsWidth > 0 && {\'width\': labelsWidth+\'px\'} || {})"\n         gantt-label-resizable="labelsWidth" gantt-label-resize-min="50" on-label-resized="raiseLabelsResized(width)" >\n        <div class="gantt-labels-head"\n             ng-show="gantt.columns.length > 0">\n            <div class="gantt-labels-head-row"\n                 ng-style="{\'margin-top\': ((gantt.getActiveHeadersCount()-1)*2)+\'em\'}">\n                <span>Description</span>\n            </div>\n        </div>\n        <div class="gantt-labels-body"\n             ng-style="(maxHeight > 0 && {\'max-height\': (maxHeight-ganttHeader.offsetHeight)+\'px\'} || {})"\n             ng-show="gantt.columns.length > 0">\n            <div gantt-vertical-scroll-receiver\n                 ng-style="{\'position\': \'relative\'}">\n                <div class="gantt-labels-row gantt-row-height"\n                     ng-class-odd="\'gantt-background-row\'"\n                     ng-class-even="\'gantt-background-row-alt\'"\n                     ng-click="raiseLabelClickedEvent($event, row)"\n                     ng-dblclick="raiseLabelDblClickedEvent($event, row)"\n                     gantt-right-click="raiseLabelContextMenuEvent($event, row)"\n                     ng-repeat="row in gantt.rows track by $index">\n                    <gantt-sortable swap="swapRows(a,b)" active="allowRowSorting" ng-model="row">\n                        <span>{{ row.description }}</span>\n                    </gantt-sortable>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="gantt-head"\n         ng-show="gantt.columns.length > 0">\n        <div gantt-horizontal-scroll-receiver\n'+"             ng-style=\"{'position': 'relative', 'width': gantt.width+'em'}\">\n            <div class=\"gantt-head-row\"\n                 ng-class=\"(gantt.headers.week !== undefined && 'gantt-head-row-bottom' || '')\"\n                 ng-if=\"gantt.headers.month !== undefined\">\n                <span ng-style=\"{'width': c.width+'em', 'left': c.left+'em'}\"\n                      ng-repeat=\"c in gantt.headers.month | ganttColumnLimit:scroll_start:scroll_width track by $index\">\n                    {{ c.date | date:'MMMM yyyy' }}\n                </span>\n            </div>\n            <div class=\"gantt-head-row\" ng-if=\"gantt.headers.week !== undefined\">\n                <span ng-style=\"{'width': c.width+'em', 'left': c.left+'em'}\"\n                      ng-repeat=\"c in gantt.headers.week | ganttColumnLimit:scroll_start:scroll_width track by $index\">\n                    {{ c.week }}\n                </span>\n            </div>\n            <div class=\"gantt-head-row\" ng-if=\"gantt.headers.day !== undefined\">\n                <span ng-style=\"{'width': c.width+'em', 'left': c.left+'em'}\"\n                      ng-repeat=\"c in gantt.headers.day | ganttColumnLimit:scroll_start:scroll_width track by $index\">\n                    {{ viewScale === 'hour' && (c.date | date:'dd EEEE') || (c.date | date:'dd') }}\n                </span>\n            </div>\n            <div class=\"gantt-head-row\" ng-if=\"gantt.headers.hour !== undefined\">\n                <span ng-style=\"{'width': c.width+'em', 'left': c.left+'em'}\"\n                      ng-repeat=\"c in gantt.headers.hour | ganttColumnLimit:scroll_start:scroll_width track by $index\">\n                    {{ c.date | date:'HH' }}\n                </span>\n            </div>\n        </div>\n    </div>\n    <div class=\"gantt-scrollable\"\n         gantt-scroll-sender\n         gantt-limit-updater\n         ng-style=\"(maxHeight > 0 && {'max-height': (maxHeight-ganttHeader.offsetHeight)+'px', 'overflow-y': 'scroll'} || {'overflow-y': 'hidden'})\"\n         ng-style=\"{'overflow-x': (gantt.rows.length == 0 && 'hidden' || 'scroll')}\">\n        <div class=\"gantt-body\"\n             ng-style=\"{'width': gantt.width+'em'}\">\n            <div class=\"gantt-body-background\">\n                <div class=\"gantt-row-height\"\n                     ng-class-odd=\"'gantt-background-row'\"\n                     ng-class-even=\"'gantt-background-row-alt'\"\n                     ng-repeat=\"row in gantt.rows track by $index\">\n                </div>\n            </div>\n            <div class=\"gantt-body-foreground\">\n                <div ng-class=\"(viewScale === 'hour' && !c.isWorkHour && 'gantt-foreground-col-nonworkhour' || (c.isWeekend && 'gantt-foreground-col-weekend' || 'gantt-foreground-col'))\"\n                     ng-style=\"{'width': c.width+'em', 'left': c.left+'em'}\"\n                     ng-repeat=\"c in gantt.columns | ganttColumnLimit:scroll_start:scroll_width track by $index\">\n                </div>\n            </div>\n            <div class=\"gantt-body-content\" data-drop=\"true\" ng-model='taskDropped' data-jqyoui-options=\"jqyouiOptions\" jqyoui-droppable=\"{onDrop: 'onDrop', onOver: 'onOver'}\">\n                <div class=\"gantt-row gantt-row-height\"\n                     id=\"gantt-row-{{row.id}}\"\n                     ng-click=\"raiseDOMRowClickedEvent($event, row)\"\n                     ng-dblclick=\"raiseDOMRowDblClickedEvent($event, row)\"\n                     gantt-right-click=\"raiseDOMRowContextMenuEvent($event, row)\"\n                     ng-repeat=\"row in gantt.rows track by row.id\">\n                    <gantt-task ng-repeat=\"task in row.tasks | ganttTaskLimit:scroll_start:scroll_width track by task.id\"></gantt-task>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>")}]);var gantt=angular.module("gantt",["ngDragDrop","templates.gantt"]);gantt.directive("gantt",["Gantt","dateFunctions","mouseOffset","debounce","keepScrollPos","Row",function(a,b,c,d,e,f){return{restrict:"EA",replace:!0,templateUrl:function(a,b){return void 0===b.templateUrl?"template/gantt.tmpl.html":b.templateUrl},scope:{sortMode:"=?",viewScale:"=?",columnWidth:"=?",columnSubScale:"=?",allowTaskMoving:"=?",allowTaskResizing:"=?",allowTaskRowSwitching:"=?",allowRowSorting:"=?",fromDate:"=?",toDate:"=?",firstDayOfWeek:"=?",weekendDays:"=?",showWeekends:"=?",workHours:"=?",showNonWorkHours:"=?",autoExpand:"=?",maxHeight:"=?",labelsWidth:"=?",showTooltips:"=?",data:"=?",loadData:"&",removeData:"&",clearData:"&",centerDate:"&",onLabelsResized:"&",onLabelClicked:"&",onLabelDblClicked:"&",onLabelContextClicked:"&",onGanttReady:"&",onRowAdded:"&",onRowClicked:"&",onRowDblClicked:"&",onRowContextClicked:"&",onRowUpdated:"&",onScroll:"&",onTaskClicked:"&",onTaskDblClicked:"&",onTaskContextClicked:"&",onTaskUpdated:"&",onTaskMoveBegin:"&",onTaskMoveEnd:"&",onTaskDropped:"&",onTaskResizeBegin:"&",onTaskResizeEnd:"&"},controller:["$scope","$element",function(g,h){void 0===g.sortMode&&(g.sortMode="name"),void 0===g.viewScale&&(g.viewScale="day"),void 0===g.columnWidth&&(g.columnWidth=2),void 0===g.columnSubScale&&(g.columnSubScale=4),void 0===g.allowTaskMoving&&(g.allowTaskMoving=!0),void 0===g.allowTaskResizing&&(g.allowTaskResizing=!0),void 0===g.allowTaskRowSwitching&&(g.allowTaskRowSwitching=!0),void 0===g.allowRowSorting&&(g.allowRowSorting=!0),void 0===g.firstDayOfWeek&&(g.firstDayOfWeek=1),void 0===g.weekendDays&&(g.weekendDays=[0,6]),void 0===g.showWeekends&&(g.showWeekends=!0),void 0===g.workHours&&(g.workHours=[8,9,10,11,12,13,14,15,16]),void 0===g.showNonWorkHours&&(g.showNonWorkHours=!0),void 0===g.maxHeight&&(g.maxHeight=0),void 0===g.autoExpand&&(g.autoExpand="none"),void 0===g.labelsWidth&&(g.labelsWidth=0),void 0===g.showTooltips&&(g.showTooltips=!0);var i=h.find(".gantt-body-content");a.setViewScale(g.viewScale,g.columnWidth,g.columnSubScale,g.firstDayOfWeek,g.weekendDays,g.showWeekends,g.workHours,g.showNonWorkHours),g.gantt=a,a.expandDefaultDateRange(g.fromDate,g.toDate),g.ganttHeader=h.children()[1],g.ganttScroll=angular.element(h.children()[2]),g.$watch("sortMode",function(a,b){angular.equals(a,b)||g.sortRows()}),g.$watch("data",function(a,b){angular.equals(a,b)||(g.removeAllData(),g.setData(a))}),g.$watch("viewScale+columnWidth+columnSubScale+firstDayOfWeek+weekendDays+showWeekends+workHours+showNonWorkHours",function(b,c){angular.equals(b,c)||(a.setViewScale(g.viewScale,g.columnWidth,g.columnSubScale,g.firstDayOfWeek,g.weekendDays,g.showWeekends,g.workHours,g.showNonWorkHours),a.reGenerateColumns()||a.expandDefaultDateRange(g.fromDate,g.toDate))}),g.$watch("fromDate+toDate",function(b,c){angular.equals(b,c)||a.expandDefaultDateRange(g.fromDate,g.toDate)}),g.getPxToEmFactor=function(){return g.ganttScroll.children()[0].offsetWidth/a.width},g.swapRows=function(b,c){a.swapRows(b,c),g.raiseRowUpdatedEvent(b,!0),g.raiseRowUpdatedEvent(c,!0),"custom"!==g.sortMode?g.sortMode="custom":g.sortRows()},g.sortRows=function(){a.sortRows(g.sortMode)},g.scrollTo=function(a){g.ganttScroll[0].scrollLeft=a,g.ganttScroll.triggerHandler("scroll")},g.scrollLeft=function(a){g.ganttScroll[0].scrollLeft-=a,g.ganttScroll.triggerHandler("scroll")},g.scrollRight=function(a){g.ganttScroll[0].scrollLeft+=a,g.ganttScroll.triggerHandler("scroll")},g.scrollToDate=function(b){var c=a.getColumnByDate(b);if(void 0!==c){var d=(c.left+c.width/2)*g.getPxToEmFactor();g.ganttScroll[0].scrollLeft=d-g.ganttScroll[0].offsetWidth/2}},g.autoExpandColumns=e(g,function(c,d,e){if("both"===g.autoExpand||g.autoExpand===!0||g.autoExpand===e){var f,h,i=1,j=31;"left"===e?(f="hour"===g.viewScale?b.addDays(d,-i,!0):b.addDays(d,-j,!0),h=d):(f=d,h="hour"===g.viewScale?b.addDays(d,i,!0):b.addDays(d,j,!0)),a.expandDefaultDateRange(f,h)}}),g.raiseLabelsResized=function(a){g.onLabelsResized({event:{width:a}})},g.raiseLabelClickedEvent=function(a,b){g.onLabelClicked({event:{evt:a,row:b,userTriggered:!0}})},g.raiseLabelDblClickedEvent=function(a,b){g.onLabelDblClicked({event:{evt:a,row:b,userTriggered:!0}})},g.raiseLabelContextMenuEvent=function(a,b){g.onLabelContextClicked({event:{evt:a,row:b,userTriggered:!0}})},g.raiseRowAddedEvent=function(a,b){g.onRowAdded({event:{row:a,userTriggered:b}})},g.raiseDOMRowClickedEvent=function(b,d){var e=c.getOffset(b).x,f=e/g.getPxToEmFactor(),h=a.getColumnByPosition(f),i=a.getDateByPosition(f);g.raiseRowClickedEvent(b,d,h,i)},g.raiseRowClickedEvent=function(a,b,c,d){g.onRowClicked({event:{evt:a,row:b,column:c.clone(),date:d,userTriggered:!0}})},g.raiseDOMRowDblClickedEvent=function(b,d){var e=c.getOffset(b).x,f=e/g.getPxToEmFactor(),h=a.getColumnByPosition(f),i=a.getDateByPosition(f);g.raiseRowDblClickedEvent(b,d,h,i)},g.raiseRowDblClickedEvent=function(a,b,c,d){g.onRowDblClicked({event:{evt:a,row:b,column:c.clone(),date:d,userTriggered:!0}})},g.raiseDOMRowContextMenuEvent=function(b,d){var e=c.getOffset(b).x,f=e/g.getPxToEmFactor(),h=a.getColumnByPosition(f),i=a.getDateByPosition(f);g.raiseRowContextMenuEvent(b,d,h,i)},g.raiseRowContextMenuEvent=function(a,b,c,d){g.onRowContextClicked({event:{evt:a,row:b,column:c.clone(),date:d,userTriggered:!0}})},g.raiseRowUpdatedEvent=function(a,b){g.onRowUpdated({event:{row:a,userTriggered:b}})},g.raiseScrollEvent=d(function(){if(void 0!==a.getDateRange()){var b,c,d=g.ganttScroll[0];0===d.scrollLeft?(b="left",c=a.getDateRange().from):d.offsetWidth+d.scrollLeft>=d.scrollWidth&&(b="right",c=a.getDateRange().to),void 0!==c&&(g.autoExpandColumns(d,c,b),g.onScroll({event:{date:c,direction:b,userTriggered:!0}}))}},5),g.raiseTaskUpdatedEvent=function(a,b){g.onTaskUpdated({event:{task:a,userTriggered:b}})},g.raiseTaskMoveStartEvent=function(a){g.onTaskMoveBegin({event:{task:a,userTriggered:!0}})},g.raiseTaskMoveEndEvent=function(a){g.onTaskMoveEnd({event:{task:a,userTriggered:!0}})},g.raiseTaskResizeStartEvent=function(a){g.onTaskResizeBegin({event:{task:a,userTriggered:!0}})},g.raiseTaskResizeEndEvent=function(a){g.onTaskResizeEnd({event:{task:a,userTriggered:!0}})},g.raiseTaskClickedEvent=function(a,b){g.onTaskClicked({event:{evt:a,task:b,userTriggered:!0}})},g.raiseTaskDblClickedEvent=function(a,b){g.onTaskDblClicked({event:{evt:a,task:b,userTriggered:!0}})},g.raiseTaskContextMenuEvent=function(a,b){g.onTaskContextClicked({event:{evt:a,task:b,userTriggered:!0}})},g.setData=e(g,function(b){for(var c=[],d=0;d<b.length;d++)c.push(new f(b[d].id,b[d].description,b[d].order,b[d].data,b[d].tasks));a.addData(c,function(a){g.raiseRowAddedEvent(a,!1)},function(a){g.raiseRowUpdatedEvent(a,!1)}),g.sortRows()}),g.removeData({fn:function(b){a.removeData(b,function(a){g.raiseRowUpdatedEvent(a,!1)}),g.sortRows()}}),g.removeAllData=function(){a.removeAllRows(),a.expandDefaultDateRange(g.fromDate,g.toDate)},g.ganttScroll.bind("scroll",g.raiseScrollEvent),g.loadData({fn:g.setData}),g.clearData({fn:g.removeAllData}),g.centerDate({fn:g.scrollToDate}),g.onGanttReady(),g.taskDropped=void 0,g.jqyouiOptions={tolerance:"pointer",activate:function(){console.log("activate)")},create:function(){console.log("create);")},deactivate:function(){console.log("deactivate);")}},g.onActivate=function(a,b){console.log("onActivate",a,b,g.taskDropped)},g.onCreate=function(a,b){console.log("onCreate",a,b,g.taskDropped)},g.onDeactivate=function(a,b){console.log("onDeactivate",a,b,g.taskDropped)},g.onOver=function(a,b){angular.element(b.draggable[0]).scope().over=!0,console.log("onOver",angular.element(b.draggable[0]).scope(),angular.element(b.helper[0]).scope()),angular.element(b.helper[0]).find(".gantt-task").scope().$parent.enableScroll(a,g)},g.onDrop=function(a,b){console.log("onDrop",a,b);var d=({clientX:b.offset.left,clientY:b.offset.top+b.helper[0].offsetHeight/2},c.getOffsetForElement(i[0],a)),e=i[0].children,f=i[0].offsetHeight/e.length,h=Math.floor((d.y-a.offsetY)/f),j=e[h];if(!angular.isDefined(j))return void 0;var k=g.gantt.rowsMap[j.id.substring(10)];newTask=k.addTask(g.taskDropped);var l=d.x/g.getPxToEmFactor();newTask.setFrom(l),newTask.to=new Date(newTask.from.getTime()+60*g.taskDropped.duration*1e3),newTask.updatePosAndSize(),g.raiseTaskAddedEvent(k,newTask,a)},g.raiseTaskAddedEvent=function(a,b,c){g.onTaskDropped({event:{row:a,task:b,userTriggered:c}})}}]}}]),gantt.factory("Column",["dateFunctions",function(a){var b=function(a,b,c){return Math.round(b/a.width*c/(b/a.subScale))*(b/a.subScale)},c=function(a,b,c,d,e,f){var g;return g=b-a.date>0&&e!==f?1:Math.round(d/c*a.subScale)/a.subScale,Math.round(10*(a.left+a.width*g))/10},d=function(a,b,c,e){var f=this;f.date=a,f.left=b,f.width=c,f.subScale=e,f.clone=function(){return new d(f.date,f.left,f.width,f.subScale)},f.equals=function(a){return f.date===a.date}},e=function(e,f,g,h){var i=new d(e,f,g,h);return i.daysInMonth=a.getDaysInMonth(i.date),i.clone=function(){return new d(i.date,i.left,i.width,i.subScale)},i.getDateByPosition=function(c){0>c&&(c=0),c>i.width&&(c=i.width);var d=a.clone(i.date);return d.setDate(1+b(i,i.daysInMonth,c)),d},i.getPositionByDate=function(a){return c(i,a,i.daysInMonth,a.getDate(),a.getMonth(),i.date.getMonth())},i},f=function(e,f,g,h,i){var j=new d(e,f,g,h);j.week=a.getWeek(e),j.firstDayOfWeek=i,j.daysInWeek=7,j.clone=function(){var a=new d(j.date,j.left,j.width,j.subScale);return a.week=j.week,a};var k=function(a){return(j.daysInWeek-j.firstDayOfWeek+a)%j.daysInWeek},l=function(a){return(j.firstDayOfWeek+a)%j.daysInWeek},m=function(b){return 1===j.firstDayOfWeek?a.getWeek(b):void a.getWeek(a.addDays(b,1-j.firstDayOfWeek,!0))};return j.getDateByPosition=function(c){0>c&&(c=0),c>j.width&&(c=j.width);var d=a.clone(j.date),e=Math.round(b(j,j.daysInWeek,c)),f=7!==e&&0>e?-1:1;return a.setToDayOfWeek(d,7!==e?l(e):l(e)+7,!1,f),d},j.getPositionByDate=function(a){return c(j,a,j.daysInWeek,k(a.getDay()),m(a),m(j.date))},j},g=function(e,f,g,h,i,j,k,l,m){var n=new d(e,f,g,h);n.isWeekend=i,n.showNonWorkHours=m;var o=0,p=24;return 9==arguments.length&&!m&&l.length>1&&(o=l[0],p=l[l.length-1]+1),n.clone=function(){var a=new d(n.date,n.left,n.width,n.subScale);return a.isWeekend=n.isWeekend,a},n.getDateByPosition=function(c,d){0>c&&(c=0),c>n.width&&(c=n.width);var e=a.clone(n.date),f=o+b(n,p-o,c);return 2==arguments.length&&(f===p&&d?(e=a.addDays(e,j),f=o):f!==o||d||(e=a.addDays(e,-k),f=p)),e.setHours(f),e},n.getPositionByDate=function(b){if(a.setTimeZero(b,!0)>a.setTimeZero(n.date,!0))return n.left+n.width;var d=p-o,e=b.getHours()-o;return 0>e?n.left:e>d?n.left+n.width:c(n,b,d,e,b.getDate(),n.date.getDate())},n},h=function(e,f,g,h,i,j,k,l){var m=new d(e,f,g,h);return m.isWeekend=i,m.isWorkHour=j,m.clone=function(){var a=new d(m.date,m.left,m.width,m.subScale);return a.isWeekend=m.isWeekend,a.isWorkHour=m.isWorkHour,a},m.getDateByPosition=function(c,d){0>c&&(c=0),c>m.width&&(c=m.width);var e=a.clone(m.date),f=b(m,60,c);return 2==arguments.length&&(60===f&&d?(e=a.addHours(e,k),f=0):0!==f||d||(e=a.addHours(e,-l),f=60)),e.setMinutes(f),e},m.getPositionByDate=function(b){return a.setTimeZero(b,!0)>a.setTimeZero(m.date,!0)?m.left+m.width:c(m,b,60,b.getMinutes(),b.getHours(),m.date.getHours())},m};return{Hour:h,Day:g,Week:f,Month:e}}]),gantt.factory("ColumnGenerator",["Column","dateFunctions",function(a,b){var c=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a[c]]=!0;return b},d=function(a,b){return a[b]===!0},e=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a[c]]=!0;return b},f=function(a,b){return a[b]===!0},g=function(g,h,i,j,k,l){this.generate=function(p,q){var r=m(q);p=b.setTimeZero(p,!0),q=b.setTimeZero(q,!0);for(var s=b.clone(p),t=[],u=0,v=e(k),w=c(i);r&&q-s>0||!r&&q-s>=0;){for(var x=d(w,s.getDay()),y=0;24>y;y++){var z=new Date(s.getFullYear(),s.getMonth(),s.getDate(),y,0,0),A=f(v,y);if((x&&j||!x)&&(!A&&l||A)){var B=1,C=1;l||(B=n(v,z.getHours()),C=o(v,z.getHours())),t.push(new a.Hour(z,u,g,h,x,A,B,C)),u+=g}}s=b.addDays(s,1)}return t},this.columnExpandNecessary=function(a,c,d,e){return m(e)&&(e=b.addHours(e,-1,!0)),a>d||c<b.setTimeZero(e,!0)};var m=function(a){return b.isTimeZero(a)},n=function(a,b){for(var c=1;25>c;c++){var d=(b+c)%24;if(f(a,d))return c}return 1},o=function(a,b){for(var c=1;25>c;c++){var d=((b-c)%24+24)%24;if(f(a,d))return c}return 1}},h=function(e,f,g,h,i,j){this.generate=function(n,o){var p=k(o);n=b.setTimeZero(n,!0),o=b.setTimeZero(o,!0);for(var q=b.clone(n),r=[],s=0,t=c(g);p&&o-q>0||!p&&o-q>=0;){var u=d(t,q.getDay());if(u&&h||!u){var v=1,w=1;h||(v=l(t,q.getDay()),w=m(t,q.getDay())),r.push(new a.Day(b.clone(q),s,e,f,u,v,w,i,j)),s+=e}q=b.addDays(q,1)}return r},this.columnExpandNecessary=function(a,c,d,e){return k(e)&&(e=b.addDays(e,-1,!0)),a>d||c<b.setTimeZero(e,!0)};var k=function(a){return b.isTimeZero(a)},l=function(a,b){for(var c=1;8>c;c++){var e=(b+c)%7;if(!d(a,e))return c}return 1},m=function(a,b){for(var c=1;8>c;c++){var e=((b-c)%7+7)%7;if(!d(a,e))return c}return 1}},i=function(c,d,e){this.generate=function(g,h){var i=f(h);g=b.setToDayOfWeek(b.setTimeZero(g,!0),e,!1),h=b.setToDayOfWeek(b.setTimeZero(h,!0),e,!1);for(var j=b.clone(g),k=[],l=0;i&&h-j>0||!i&&h-j>=0;)k.push(new a.Week(b.clone(j),l,c,d,e)),l+=c,j=b.addWeeks(j,1);return k},this.columnExpandNecessary=function(a,c,d,g){return f(g)&&(g=b.addWeeks(g,-1,!0)),a>d||c<b.setToDayOfWeek(b.setTimeZero(g,!0),e)};var f=function(a){return a.getDay()===e&&b.isTimeZero(a)}},j=function(c,d){this.generate=function(f,g){var h=e(g);f=b.setToFirstDayOfMonth(b.setTimeZero(f,!0),!1),g=b.setToFirstDayOfMonth(b.setTimeZero(g,!0),!1);for(var i=b.clone(f),j=[],k=0;h&&g-i>0||!h&&g-i>=0;)j.push(new a.Month(b.clone(i),k,c,d)),k+=c,i=b.addMonths(i,1);return j},this.columnExpandNecessary=function(a,c,d,f){return e(f)&&(f=b.addMonths(f,-1,!0)),a>d||c<b.setToFirstDayOfMonth(b.setTimeZero(f,!0))};var e=function(a){return 1===a.getDate()&&b.isTimeZero(a)}};return{HourGenerator:g,DayGenerator:h,WeekGenerator:i,MonthGenerator:j}}]),gantt.factory("GanttFactory",["Row","ColumnGenerator","HeaderGenerator","dateFunctions","binarySearch",function(a,b,c,d,e){var f=function(f,g,h,i,j,k,l,m){var n=this;n.rowsMap={},n.rows=[],n.columns=[],n.headers={},n.width=0;var o;n.setViewScale=function(a,d,e,f,g,h,i,j){switch(a){case"hour":n.columnGenerator=new b.HourGenerator(d,e,g,h,i,j);break;case"day":n.columnGenerator=new b.DayGenerator(d,e,g,h,i,j);break;case"week":n.columnGenerator=new b.WeekGenerator(d,e,f);break;case"month":n.columnGenerator=new b.MonthGenerator(d,e);break;default:throw"Unsupported view scale: "+a}n.headerGenerator=new c.instance(a)},n.setViewScale(f,g,h,i,j,k,l,m),n.expandDefaultDateRange=function(a,b){void 0!==a&&void 0!==b&&(p(a,b),q())};var p=function(a,b){a=d.clone(a),b=d.clone(b),void 0===o?(o={},o.from=a,o.to=b):(a<o.from&&(o.from=a),b>o.to&&(o.to=b))},q=function(){if(void 0===o)throw"From and to date range cannot be undefined";if(0===n.columns.length)r(o.from,o.to);else if(n.columnGenerator.columnExpandNecessary(n.getFirstColumn().date,n.getLastColumn().date,o.from,o.to)){var a=n.getFirstColumn().date>o.from?o.from:n.getFirstColumn().date,b=n.getLastColumn().date<o.to?o.to:n.getLastColumn().date;r(a,b)}},r=function(a,b){n.columns=n.columnGenerator.generate(a,b),n.headers=n.headerGenerator.generate(n.columns),n.updateTasksPosAndSize();var c=n.getLastColumn();n.width=void 0!==c?c.left+c.width:0};n.reGenerateColumns=function(){return n.columns=[],void 0!==o?(q(),!0):!1},n.updateTasksPosAndSize=function(){for(var a=0,b=n.rows.length;b>a;a++)for(var c=0,d=n.rows[a].tasks.length;d>c;c++)n.rows[a].tasks[c].updatePosAndSize()},n.getLastColumn=function(){return n.columns.length>0?n.columns[n.columns.length-1]:void 0},n.getFirstColumn=function(){return n.columns.length>0?n.columns[0]:void 0},n.getColumnByDate=function(a){var b=e.get(n.columns,a,function(a){return a.date});return void 0!==b[0]?b[0]:b[1]},n.getColumnByPosition=function(a){return e.get(n.columns,a,function(a){return a.left})[0]},n.getDateByPosition=function(a,b){var c=n.getColumnByPosition(a);return void 0!==c?2==arguments.length?c.getDateByPosition(a-c.left,b):c.getDateByPosition(a-c.left):void 0},n.getPositionByDate=function(a){var b=n.getColumnByDate(a);return void 0!==b?b.getPositionByDate(a):void 0},n.getDateRange=function(){return void 0===o?void 0:{from:d.clone(o.from),to:d.clone(o.to)}},n.getTasksDateRange=function(){if(0===n.rows.length)return void 0;for(var a,b,c=0,d=n.rows.length;d>c;c++){var e=n.rows[c];(void 0===a||e.minFromDate<a)&&(a=e.minFromDate),(void 0===b||e.maxToDate>b)&&(b=e.maxToDate)}return{from:a,to:b}},n.getActiveHeadersCount=function(){var a,b=0;for(a in n.headers)n.headers.hasOwnProperty(a)&&b++;return b},n.addData=function(a,b,c){for(var d=0,e=a.length;e>d;d++){var f=a[d],g=s(f),h=n.rowsMap[f.id];g===!0&&void 0!==c?c(h):void 0!==b&&b(h)}void 0!==o&&q()};var s=function(b){var c,d=!1;if(b.id in n.rowsMap)c=n.rowsMap[b.id],c.copy(b),d=!0;else{var e=b.order;void 0===e&&(e=n.highestRowOrder),e>=n.highestRowOrder&&(n.highestRowOrder=e+1),c=new a(b.id,n,b.description,e,b.data),n.rowsMap[b.id]=c,n.rows.push(c)}if(void 0!==b.tasks&&b.tasks.length>0)for(var f=0,g=b.tasks.length;g>f;f++){var h=c.addTask(b.tasks[f]);p(h.from,h.to),h.updatePosAndSize()}return d};n.removeData=function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(void 0!==e.tasks&&e.tasks.length>0){if(e.id in n.rowsMap){for(var f=n.rowsMap[e.id],g=0,h=e.tasks.length;h>g;g++)f.removeTask(e.tasks[g].id);void 0!==b&&b(f)}}else t(e.id)}};var t=function(a){if(a in n.rowsMap){delete n.rowsMap[a];for(var b=0,c=n.rows.length;c>b;b++){var d=n.rows[b];if(d.id===a)return n.rows.splice(b,1),d}}return void 0};n.removeAllRows=function(){n.rowsMap={},n.rows=[],n.highestRowOrder=0,n.columns=[],o=void 0},n.swapRows=function(a,b){var c=a.order;a.order=b.order,b.order=c};var u=function(a,b){return void 0===a.minFromDate&&void 0===b.minFromDate?v(a,b):void 0===a.minFromDate?1:void 0===b.minFromDate?-1:a.minFromDate-b.minFromDate},v=function(a,b){return a.description.toLowerCase()===b.description.toLowerCase()?0:a.description.toLowerCase()<b.description.toLowerCase()?-1:1},w=function(a,b){return void 0===a.order&&void 0===b.order?v(a,b):void 0===a.order?1:void 0===b.order?-1:a.order-b.order};n.sortRows=function(a){switch(a){case"name":n.rows.sort(v);break;case"-name":n.rows.reverse(v);break;case"date":n.rows.sort(u);break;case"-date":n.rows.reverse(u);break;case"custom":n.rows.sort(w);break;case"-custom":n.rows.reverse(w);break;default:n.rows.sort(u)}}};return f}]),gantt.service("Gantt",["ColumnGenerator","HeaderGenerator","dateFunctions","binarySearch",function(a,b,c,d){var e=this;e.rowsMap={},e.rows=[],e.columns=[],e.headers={},e.width=0;var f;e.setViewScale=function(c,d,f,g,h,i,j,k){switch(c){case"hour":e.columnGenerator=new a.HourGenerator(d,f,h,i,j,k);break;case"day":e.columnGenerator=new a.DayGenerator(d,f,h,i,j,k);break;case"week":e.columnGenerator=new a.WeekGenerator(d,f,g);break;case"month":e.columnGenerator=new a.MonthGenerator(d,f);break;default:throw"Unsupported view scale: "+c}e.headerGenerator=new b.instance(c)},e.expandDefaultDateRange=function(a,b){void 0!==a&&void 0!==b&&(g(a,b),h())};var g=function(a,b){a=c.clone(a),b=c.clone(b),void 0===f?(f={},f.from=a,f.to=b):(a<f.from&&(f.from=a),b>f.to&&(f.to=b))},h=function(){if(void 0===f)throw"From and to date range cannot be undefined";if(0===e.columns.length)i(f.from,f.to);else if(e.columnGenerator.columnExpandNecessary(e.getFirstColumn().date,e.getLastColumn().date,f.from,f.to)){var a=e.getFirstColumn().date>f.from?f.from:e.getFirstColumn().date,b=e.getLastColumn().date<f.to?f.to:e.getLastColumn().date;i(a,b)}},i=function(a,b){e.columns=e.columnGenerator.generate(a,b),e.headers=e.headerGenerator.generate(e.columns),e.updateTasksPosAndSize();var c=e.getLastColumn();e.width=void 0!==c?c.left+c.width:0};e.reGenerateColumns=function(){return e.columns=[],void 0!==f?(h(),!0):!1},e.updateTasksPosAndSize=function(){for(var a=0,b=e.rows.length;b>a;a++)for(var c=0,d=e.rows[a].tasks.length;d>c;c++)e.rows[a].tasks[c].updatePosAndSize()},e.getLastColumn=function(){return e.columns.length>0?e.columns[e.columns.length-1]:void 0},e.getFirstColumn=function(){return e.columns.length>0?e.columns[0]:void 0},e.getColumnByDate=function(a){var b=d.get(e.columns,a,function(a){return a.date});return void 0!==b[0]?b[0]:b[1]},e.getColumnByPosition=function(a){return d.get(e.columns,a,function(a){return a.left})[0]},e.getDateByPosition=function(a,b){var c=e.getColumnByPosition(a);return void 0!==c?2==arguments.length?c.getDateByPosition(a-c.left,b):c.getDateByPosition(a-c.left):void 0},e.getPositionByDate=function(a){var b=e.getColumnByDate(a);return void 0!==b?b.getPositionByDate(a):void 0},e.getDateRange=function(){return void 0===f?void 0:{from:c.clone(f.from),to:c.clone(f.to)}},e.getTasksDateRange=function(){if(0===e.rows.length)return void 0;for(var a,b,c=0,d=e.rows.length;d>c;c++){var f=e.rows[c];(void 0===a||f.minFromDate<a)&&(a=f.minFromDate),(void 0===b||f.maxToDate>b)&&(b=f.maxToDate)}return{from:a,to:b}},e.getActiveHeadersCount=function(){var a,b=0;for(a in e.headers)e.headers.hasOwnProperty(a)&&b++;return b},e.addData=function(a,b,c){for(var d=0,g=a.length;g>d;d++){var i=a[d],k=j(i),l=e.rowsMap[i.id];k===!0&&void 0!==c?c(l):void 0!==b&&b(l)}void 0!==f&&h()};var j=function(a){var b,c=!1;if(a.id in e.rowsMap)b=e.rowsMap[a.id],b.copy(a),c=!0;else{var d=a.order;void 0===d&&(d=e.highestRowOrder),d>=e.highestRowOrder&&(e.highestRowOrder=d+1),e.rowsMap[a.id]=a,e.rows.push(a)}if(void 0!==a.tasks&&a.tasks.length>0)for(var f=0,h=a.tasks.length;h>f;f++){var i=a.tasks[f];g(i.from,i.to),i.updatePosAndSize()}return c};e.removeData=function(a,b){for(var c=0,d=a.length;d>c;c++){var f=a[c];if(void 0!==f.tasks&&f.tasks.length>0){if(f.id in e.rowsMap){for(var g=e.rowsMap[f.id],h=0,i=f.tasks.length;i>h;h++)g.removeTask(f.tasks[h].id);void 0!==b&&b(g)}}else k(f.id)}};var k=function(a){if(a in e.rowsMap){delete e.rowsMap[a];for(var b=0,c=e.rows.length;c>b;b++){var d=e.rows[b];if(d.id===a)return e.rows.splice(b,1),d}}return void 0};e.removeAllRows=function(){e.rowsMap={},e.rows=[],e.highestRowOrder=0,e.columns=[],f=void 0},e.swapRows=function(a,b){var c=a.order;a.order=b.order,b.order=c};var l=function(a,b){return void 0===a.minFromDate&&void 0===b.minFromDate?m(a,b):void 0===a.minFromDate?1:void 0===b.minFromDate?-1:a.minFromDate-b.minFromDate},m=function(a,b){return a.description.toLowerCase()===b.description.toLowerCase()?0:a.description.toLowerCase()<b.description.toLowerCase()?-1:1},n=function(a,b){return void 0===a.order&&void 0===b.order?m(a,b):void 0===a.order?1:void 0===b.order?-1:a.order-b.order};e.sortRows=function(a){switch(a){case"name":e.rows.sort(m);break;case"-name":e.rows.reverse(m);break;case"date":e.rows.sort(l);break;case"-date":e.rows.reverse(l);break;case"custom":e.rows.sort(n);break;case"-custom":e.rows.reverse(n);break;default:e.rows.sort(l)}}}]),gantt.factory("HeaderGenerator",["Column","dateFunctions",function(a,b){var c=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getHours()!==h.date.getHours()?(d=new a.Hour(b.clone(h.date),h.left,h.width,h.isWeekend,h.isWorkHour),e.push(d)):d.width+=h.width}return e},d=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];
0===f||c[f-1].date.getDay()!==h.date.getDay()?(d=new a.Day(b.clone(h.date),h.left,h.width,h.isWeekend,h.daysToNextWorkingDay,h.daysToPrevWorkingDay),e.push(d)):d.width+=h.width}return e},e=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||b.getWeek(c[f-1].date)!==b.getWeek(h.date)?(d=new a.Week(b.clone(h.date),h.left,h.width,b.getWeek(h.date)),e.push(d)):d.width+=h.width}return e},f=function(c){for(var d,e=[],f=0,g=c.length;g>f;f++){var h=c[f];0===f||c[f-1].date.getMonth()!==h.date.getMonth()?(d=new a.Month(b.clone(h.date),h.left,h.width),e.push(d)):d.width+=h.width}return e};return{instance:function(a){this.generate=function(b){var g={};switch(a){case"hour":g.hour=c(b),g.day=d(b);break;case"day":g.day=d(b),g.week=e(b),g.month=f(b);break;case"week":g.week=e(b),g.month=f(b);break;case"month":g.month=f(b);break;default:throw"Unsupported view scale: "+a}return g}}}}]),gantt.factory("Row",["Task","dateFunctions",function(a,b){var c=function(d,e,f,g,h){var i=this;i.id=d,i.description=e,i.order=f,i.tasksMap={},i.tasks=[],i.data=g,i.sortTasks=function(){i.tasks.sort(function(a,b){return a.left-b.left})},i.setMinMaxDateByTask=function(a){void 0===i.minFromDate?i.minFromDate=b.clone(a.from):a.from<i.minFromDate&&(i.minFromDate=b.clone(a.from)),void 0===i.maxToDate?i.maxToDate=b.clone(a.to):a.to>i.maxToDate&&(i.maxToDate=b.clone(a.to))},i.addTask=function(b){var c;return b.id in i.tasksMap?(c=i.tasksMap[b.id],c.copy(b)):(c=new a(b.id,i,b.subject,b.color,b.classes,b.priority,b.from,b.to,b.data,b.est,b.lct),i.tasksMap[b.id]=c,i.tasks.push(c)),i.sortTasks(),i.setMinMaxDateByTask(c),c};for(var j=0;j<h.length;j++)i.addTask(h[j]);i.moveTaskToRow=function(a){a.row.removeTask(a.id),i.tasksMap[a.id]=a,i.tasks.push(a),i.setTasksMinMaxDate(),a.row=i,a.updatePosAndSize()},i.removeTask=function(a){if(a in i.tasksMap){delete i.tasksMap[a];for(var b=0,c=i.tasks.length;c>b;b++){var d=i.tasks[b];if(d.id===a)return i.tasks.splice(b,1),(i.minFromDate-d.from===0||i.maxToDate-d.to===0)&&i.setTasksMinMaxDate(),d}}},i.setTasksMinMaxDate=function(){i.minFromDate=void 0,i.maxToDate=void 0;for(var a=0,b=i.tasks.length;b>a;a++)i.setMinMaxDateByTask(i.tasks[a])},i.copy=function(a){i.description=a.description,i.data=a.data,void 0!==a.order&&(i.order=a.order)},i.clone=function(){for(var a=new c(i.id,i.description,i.order,i.data),b=0,d=i.tasks.length;d>b;b++)a.addTask(i.tasks[b].clone());return a}};return c}]),gantt.factory("Task",["dateFunctions","Gantt",function(a,b){var c=function(d,e,f,g,h,i,j,k,l,m,n){var o=this;o.id=d,o.row=e,o.subject=f,o.color=g,o.classes=h,o.priority=i,o.from=a.clone(j),o.to=a.clone(k),o.data=l,void 0!==m&&void 0!==n&&(o.est=a.clone(m),o.lct=a.clone(n)),o.checkIfMilestone=function(){o.isMilestone=o.from-o.to===0},o.checkIfMilestone(),o.hasBounds=function(){return void 0!==o.bounds},o.updatePosAndSize=function(){o.left=b.getPositionByDate(o.from),o.width=Math.round(10*(b.getPositionByDate(o.to)-o.left))/10,void 0!==o.est&&void 0!==o.lct&&(o.bounds={},o.bounds.left=b.getPositionByDate(o.est),o.bounds.width=Math.round(10*(b.getPositionByDate(o.lct)-o.bounds.left))/10)},o.setFrom=function(a){a>o.left+o.width?a=o.left+o.width:0>a&&(a=0),o.from=b.getDateByPosition(a,!0),o.row.setMinMaxDateByTask(o),o.updatePosAndSize(),o.checkIfMilestone()},o.setTo=function(a){a<o.left?a=o.left:a>b.width&&(a=b.width),o.to=b.getDateByPosition(a,!1),o.row.setMinMaxDateByTask(o),o.updatePosAndSize(),o.checkIfMilestone()},o.moveTo=function(a){0>a?a=0:a+o.width>=b.width&&(a=b.width-o.width),o.from=b.getDateByPosition(a,!0),o.left=b.getPositionByDate(o.from),o.to=b.getDateByPosition(o.left+o.width,!1),o.width=Math.round(10*(b.getPositionByDate(o.to)-o.left))/10,o.row.setMinMaxDateByTask(o)},o.copy=function(b){o.subject=b.subject,o.color=b.color,o.classes=b.classes,o.priority=b.priority,o.from=a.clone(b.from),o.to=a.clone(b.to),o.est=void 0!==b.est?a.clone(b.est):void 0,o.lct=void 0!==b.lct?a.clone(b.lct):void 0,o.data=b.data,o.isMilestone=b.isMilestone},o.clone=function(){return new c(o.id,o.row,o.subject,o.color,o.classes,o.priority,o.from,o.to,o.data,o.est,o.lct)}};return c}]),gantt.factory("DroppableTask",["dateFunctions","Gantt",function(a,b){var c=function(d,e,f,g,h,i,j,k,l,m){var n=this;n.id=d,n.subject=e,n.color=f,n.classes=g,n.priority=h,n.from=a.clone(i),n.to=a.clone(j),n.data=k,void 0!==l&&void 0!==m&&(n.est=a.clone(l),n.lct=a.clone(m)),n.checkIfMilestone=function(){n.isMilestone=n.from-n.to===0},n.checkIfMilestone(),n.hasBounds=function(){return void 0!==n.bounds},n.updatePosAndSize=function(){n.left=b.getPositionByDate(n.from),n.width=Math.round(10*(b.getPositionByDate(n.to)-n.left))/10,void 0!==n.est&&void 0!==n.lct&&(n.bounds={},n.bounds.left=b.getPositionByDate(n.est),n.bounds.width=Math.round(10*(b.getPositionByDate(n.lct)-n.bounds.left))/10)},n.setFrom=function(a){a>n.left+n.width?a=n.left+n.width:0>a&&(a=0),n.from=b.getDateByPosition(a,!0),n.updatePosAndSize(),n.checkIfMilestone()},n.setTo=function(a){a<n.left?a=n.left:a>b.width&&(a=b.width),n.to=b.getDateByPosition(a,!1),n.updatePosAndSize(),n.checkIfMilestone()},n.moveTo=function(a){0>a?a=0:a+n.width>=b.width&&(a=b.width-n.width),n.from=b.getDateByPosition(a,!0),n.left=b.getPositionByDate(n.from),n.to=b.getDateByPosition(n.left+n.width,!1),n.width=Math.round(10*(b.getPositionByDate(n.to)-n.left))/10},n.copy=function(b){n.subject=b.subject,n.color=b.color,n.classes=b.classes,n.priority=b.priority,n.from=a.clone(b.from),n.to=a.clone(b.to),n.est=void 0!==b.est?a.clone(b.est):void 0,n.lct=void 0!==b.lct?a.clone(b.lct):void 0,n.data=b.data,n.isMilestone=b.isMilestone},n.clone=function(){return new c(n.id,n.subject,n.color,n.classes,n.priority,n.from,n.to,n.data,n.est,n.lct)}};return c}]),gantt.service("binarySearch",[function(){return{getIndicesOnly:function(a,b,c){for(var d=-1,e=a.length;e-d>1;){var f=Math.floor((d+e)/2);c(a[f])<=b?d=f:e=f}return void 0!==a[d]&&c(a[d])===b&&(e=d),[d,e]},get:function(a,b,c){var d=this.getIndicesOnly(a,b,c);return[a[d[0]],a[d[1]]]}}}]),gantt.service("dateFunctions",[function(){return{isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isString:function(a){return"string"==typeof a||"object"==typeof a&&a.constructor===String},clone:function(a){return new Date(this.isString(a)?Date.parse(a):this.isNumber(a)?a:a.getTime())},setTimeZero:function(a,b){var c=b===!0?this.clone(a):a;return c.setHours(0),c.setMinutes(0),c.setMilliseconds(0),c},setTimeComponent:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,b)},setToFirstDayOfMonth:function(a,b){var c=b===!0?this.clone(a):a;return c.setDate(1),c},setToDayOfWeek:function(a,b,c,d){var e=c===!0?this.clone(a):a;if(e.getDay()===b)return e;d=d||-1;var f=(b-e.getDay()+7*(d||1))%7;return this.addDays(e,0===f?f+=7*(d||1):f)},addMonths:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(1),d.setMonth(d.getMonth()+b),d},addWeeks:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+7*b),d},addDays:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+b),d},addHours:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setHours(d.getHours()+b),d},addMinutes:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMinutes(d.getMinutes()+b),d},addMilliseconds:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMilliseconds(d.getMilliseconds()+b),d},isTimeZero:function(a){return 0===a.getHours()&&0===a.getMinutes()&&0===a.getMinutes()&&0===a.getMilliseconds()},getDaysInMonth:function(a){return new Date(a.getYear(),a.getMonth()+1,0).getDate()},getWeek:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),2>=c?(e=b-1,f=(e/4|0)-(e/100|0)+(e/400|0),g=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),m=f-g,i=0,j=d-1+31*(c-1)):(e=b,f=(e/4|0)-(e/100|0)+(e/400|0),g=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),m=f-g,i=m+1,j=d+(153*(c-3)+2)/5+58+m),k=(e+f)%7,h=(j+k-i)%7,l=j+3-h|0,n=0>l?53-((k-m)/5|0):l>364+m?1:(l/7|0)+1,b=c=d=null,n}}}]),gantt.filter("ganttColumnLimit",["binarySearch",function(a){return function(b,c,d){var e=function(a){return a.left},f=a.getIndicesOnly(b,c,e)[0],g=a.getIndicesOnly(b,c+d,e)[1];return b.slice(f,g)}}]),gantt.directive("ganttLimitUpdater",["$timeout",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){var d=c[0],e=function(){b.scroll_start=d.scrollLeft/b.getPxToEmFactor(),b.scroll_width=d.offsetWidth/b.getPxToEmFactor()};c.bind("scroll",function(){b.$apply(function(){e()})}),b.$watch("gantt.width",function(){a(function(){e()},20,!0)})}]}}]),gantt.filter("ganttTaskLimit",[function(){return function(a,b,c){for(var d=[],e=0,f=a.length;f>e;e++){var g=a[e];(g.left>=b&&g.left<=b+c||g.left+g.width>=b&&g.left+g.width<=b+c||g.left<b&&g.left+g.width>b+c||g.isMoving===!0)&&d.push(g)}return d}}]),gantt.directive("ganttLabelResizable",["$document","debounce","mouseOffset",function(a,b,c){return{restrict:"A",scope:{width:"=ganttLabelResizable",minWidth:"=ganttLabelResizeMin",onResized:"&onLabelResized"},controller:["$scope","$element",function(d,e){var f,g=5,h="ew-resize";e.bind("mousedown",function(a){j(a)&&(k(a),a.preventDefault())}),e.bind("mousemove",function(a){j(a)?e.css("cursor",h):e.css("cursor","")});var i=function(a){0===d.width&&(d.width=e[0].offsetWidth),d.width+=a-f,d.width<d.minWidth&&(d.width=d.minWidth),f=a},j=function(a){var b=c.getOffset(a).x;return b>e[0].offsetWidth-g},k=function(c){f=c.screenX,angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:h});var d=b(function(a){i(a.screenX)},5);angular.element(a[0].body).bind("mousemove",d),angular.element(a[0].body).one("mouseup",function(){angular.element(a[0].body).unbind("mousemove",d),l()})},l=function(){e.css("cursor",""),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),d.onResized({width:d.width})}}]}}]),gantt.directive("ganttRightClick",["$parse",function(a){return{restrict:"A",compile:function(b,c){var d=a(c.ganttRightClick);return function(a,b){b.on("contextmenu",function(b){a.$apply(function(){d(a,{$event:b})})})}}}}]),gantt.directive("ganttHorizontalScrollReceiver",["scrollManager",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.horizontal.push(c[0])}]}}]),gantt.service("scrollManager",[function(){return{vertical:[],horizontal:[]}}]),gantt.directive("ganttScrollSender",["scrollManager","$timeout",function(a,b){return{restrict:"A",controller:["$scope","$element",function(c,d){var e=d[0],f=function(){var b,c;for(b=0,c=a.vertical.length;c>b;b++){var d=a.vertical[b];d.style.top!==-e.scrollTop&&(d.style.top=-e.scrollTop+"px")}for(b=0,c=a.horizontal.length;c>b;b++){var f=a.horizontal[b];f.style.left!==-e.scrollLeft&&(f.style.left=-e.scrollLeft+"px")}};d.bind("scroll",f),c.$watch("gantt.width",function(a){0===a&&b(function(){f()},0,!0)})}]}}]),gantt.directive("ganttVerticalScrollReceiver",["scrollManager",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.vertical.push(c[0])}]}}]),gantt.service("sortManager",[function(){return{startRow:void 0}}]),gantt.directive("ganttSortable",["$document","sortManager",function(a,b){return{restrict:"E",template:"<div ng-transclude></div>",replace:!0,transclude:!0,scope:{row:"=ngModel",swap:"&",active:"=?"},controller:["$scope","$element",function(c,d){d.bind("mousedown",function(){if(c.active===!0){f();var b=function(){c.$apply(function(){angular.element(a[0].body).unbind("mouseup",b),g()})};angular.element(a[0].body).bind("mouseup",b)}}),d.bind("mousemove",function(d){if(e()){var f=angular.element(a[0].elementFromPoint(d.clientX,d.clientY)),g=f.controller("ngModel").$modelValue;c.$apply(function(){c.swap({a:g,b:b.startRow})})}});var e=function(){return void 0!==b.startRow&&!angular.equals(c.row,b.startRow)},f=function(){b.startRow=c.row,d.css("cursor","move"),angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"no-drop"})},g=function(){b.startRow=void 0,d.css("cursor","pointer"),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:"auto"})}}]}}]),gantt.directive("ganttBounds",[function(){return{restrict:"E",templateUrl:function(a,b){return void 0===b.templateUrl?"default.bounds.tmpl.html":b.templateUrl},replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(a){var b={};a.task.hasBounds()||(a.visible=!1),a.getCss=function(){return a.task.hasBounds()&&(b.width=a.task.bounds.width+"em",b.left=a.task.isMilestone===!0||0===a.task.width?a.task.bounds.left-(a.task.left-.3)+"em":a.task.bounds.left-a.task.left+"em"),b},a.getClass=function(){return void 0===a.task.est||void 0===a.task.lct?"gantt-task-bounds-in":a.task.est>a.task.from?"gantt-task-bounds-out":a.task.lct<a.task.to?"gantt-task-bounds-out":"gantt-task-bounds-in"},a.$watch("task.isMouseOver",function(){a.task.hasBounds()&&!a.task.isMoving&&(a.visible=!(void 0===a.task.isMouseOver||a.task.isMouseOver===!1))}),a.$watch("task.isMoving",function(b){a.task.hasBounds()&&(a.visible=b===!0)})}]}}]),gantt.directive("ganttTaskDrag",["Gantt","DroppableTask",function(a,b){return{restrict:"E",templateUrl:function(a,b){return void 0===b.templateUrl?"template/gantt.task.drag.tmpl.html":b.templateUrl},scope:{task:"="},replace:!0,controller:["$scope","$element","$timeout","$window","debounce","mouseOffset","smartEvent",function(c,d,e,f,g,h,i){var j,k,l,m,n,o=angular.element(f),p=15,q=5;c.dragActive=!1,c.onStart=function(){c.dragActive=!0;var d;console.log("onStart",c.task),angular.isDefined(c.task.from)||(c.task.from=a.getDateRange().from),angular.isDefined(c.task.to)||(d=c.task.duration,angular.isDefined(d)||(c.task.duration=240),c.task.to=new Date(c.task.from.getTime()+60*c.task.duration*1e3),d=c.task.duration),c.task=new b(c.task.id,c.task.subject,c.task.color,c.task.classes,c.task.priority,c.task.from,c.task.to,c.task.data,void 0,void 0),c.task.duration=d,c.task.updatePosAndSize()},c.onStop=function(){c.dragActive=!1,angular.isDefined(m)&&(o.unbind("mousemove",m),w()),console.log("onStop")},c.jqyouiOptions={revert:"invalid",cursorAt:{left:0,top:5},scroll:!1};var r=function(){if(!angular.isDefined(k)){var a=angular.element(f.document.body);k=a.find(".gantt"),l=k.parent().parent()}},s=function(){void 0!==n&&(e.cancel(n),n=void 0)},t=function(a,b){var c=l[0].scrollLeft,d=!1;if(b.x<moveStartX)b.x<=c+q&&(b.x-=p,d=!0,j.scrollLeft(p));else{var f=l[0].offsetWidth,g=c+f;b.x>=g-q&&(b.x+=p,d=!0,j.scrollRight(p))}d&&(n=e(function(){u(a,b)},100,!0))},u=function(a,b){t(a,b)},v=function(a,b){moveStartX=b;var d=moveStartX/j.getPxToEmFactor();mouseOffsetInEm=d-c.task.left,m=g(function(b){var c=h.getOffsetForElement(k[0],b);s(),u(a,c)},5),i(c,o,"mousemove",m).bind(),i(c,o,"mouseup",function(){c.$apply(function(){o.unbind("mousemove",m),w()})}).bindOnce()},w=function(){s(),c.task.modeMode=null};c.enableScroll=function(a,b){j=b,r();var c=h.getOffsetForElement(k[0],a).x;v("M",c)}}]}}]),gantt.directive("ganttTask",["$window","$document","$timeout","smartEvent","debounce","dateFunctions","mouseOffset","mouseButton","Gantt",function(a,b,c,d,e,f,g,h,i){return{restrict:"E",templateUrl:function(a,b){return void 0===b.templateUrl?"template/gantt.task.tmpl.html":b.templateUrl},replace:!0,controller:["$scope","$element",function(f,j){var k,l,m,n=5,o=3,p=15,q=5,r=angular.element(a),s=j.parent().parent(),t=s.parent().parent(),u=!1;j.bind("mousedown",function(a){f.$apply(function(){var b=A(a);if(""!==b&&1===h.getButton(a)){var c=g.getOffsetForElement(s[0],a).x;C(b,c)}})}),j.bind("click",function(a){f.$apply(function(){u||f.raiseTaskClickedEvent(a,f.task),a.stopPropagation()})}),j.bind("dblclick",function(a){f.$apply(function(){u||f.raiseTaskDblClickedEvent(a,f.task),a.stopPropagation()})}),j.bind("contextmenu",function(a){f.$apply(function(){u||f.raiseTaskContextMenuEvent(a,f.task),a.stopPropagation()})}),j.bind("mousemove",e(function(a){var b=A(a);""!==b&&"M"!==b?j.css("cursor",B(b)):j.css("cursor",""),f.task.mouseX=a.clientX},5)),j.bind("mouseenter",function(a){f.$apply(function(){f.task.mouseX=a.clientX,f.task.isMouseOver=!0})}),j.bind("mouseleave",function(){f.$apply(function(){f.task.isMouseOver=!1})});var v=function(a,b){f.task.isMoving!==!1&&(w(a,b),x(a,b))},w=function(a,b){f.task.mouseOffsetX=b.x;var c=b.x/f.getPxToEmFactor();if("M"===a){if(f.allowTaskRowSwitching){var d=z(b.y);void 0!==d&&f.task.row.id!==d.id&&d.moveTaskToRow(f.task)}f.allowTaskMoving&&f.task.moveTo(c-k)}else"E"===a?f.task.setTo(c):f.task.setFrom(c);u=!0},x=function(a,b){var d=t[0].scrollLeft,e=!1;if(b.x<l)b.x<=d+q&&(b.x-=p,e=!0,f.scrollLeft(p));else{var g=t[0].offsetWidth,h=d+g;b.x>=h-q&&(b.x+=p,e=!0,f.scrollRight(p))}e&&(m=c(function(){v(a,b)},100,!0))},y=function(){void 0!==m&&(c.cancel(m),m=void 0)},z=function(a){var b=s[0].offsetHeight/i.rows.length,c=Math.floor(a/b);return i.rows[c]},A=function(a){var b=g.getOffset(a).x,c=0;return f.allowTaskResizing&&(c=j[0].offsetWidth<10?o:n),f.allowTaskResizing&&b>j[0].offsetWidth-c?"E":f.allowTaskResizing&&c>b?"W":(f.allowTaskMoving||f.allowTaskRowSwitching)&&b>=c&&b<=j[0].offsetWidth-c?"M":""},B=function(a){switch(a){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},C=function(a,c){f.task.isMoving||("M"===a?f.raiseTaskMoveStartEvent(f.task):f.raiseTaskResizeStartEvent(f.task)),u=!1,f.task.moveMode=a,f.task.isMoving=!0,l=c;var h=l/f.getPxToEmFactor();k=h-f.task.left;var i=e(function(b){var c=g.getOffsetForElement(s[0],b);y(),v(a,c)},5);d(f,r,"mousemove",i).bind(),d(f,r,"mouseup",function(){f.$apply(function(){r.unbind("mousemove",i),D()})}).bindOnce(),angular.element(b[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:B(a)})},D=function(){f.task.isMoving=!1,y(),j.css("cursor",""),angular.element(b[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),"M"===f.task.moveMode?f.raiseTaskMoveEndEvent(f.task):f.raiseTaskResizeEndEvent(f.task),f.task.modeMode=null,u===!0&&(f.task.row.sortTasks(),f.raiseTaskUpdatedEvent(f.task,!0))};f.task.isMoving&&C("M",f.task.mouseOffsetX)}]}}]),gantt.directive("ganttTooltip",["$timeout","$document","debounce","smartEvent",function(a,b,c,d){return{restrict:"E",templateUrl:function(a,b){return void 0===b.templateUrl?"default.tooltip.tmpl.html":b.templateUrl},replace:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(e,f){var g=angular.element(b[0].body),h=f.parent();e.visible=!1,e.css={},e.$watch("task.isMouseOver",function(a){a===!0?k(e.task.mouseX):a===!1&&e.task.isMoving===!1&&m()});var i=d(e,g,"mousemove",c(function(a){e.visible===!0?l(a.clientX):k(a.clientX)},1));e.$watch("task.isMoving",function(a){a===!0?i.bind():a===!1&&(i.unbind(),m())});var j=function(){var a=b[0];return a.documentElement.clientWidth||a.documentElement.getElementById("body")[0].clientWidth},k=function(b){e.visible=!0,a(function(){l(b),e.css.top=h[0].getBoundingClientRect().top+"px",e.css.marginTop=-f[0].offsetHeight-8+"px",e.css.opacity=1},1,!0)},l=function(a){f.removeClass("gantt-task-infoArrow"),f.removeClass("gantt-task-infoArrowR"),a+f[0].offsetWidth>j()?(e.css.left=a+20-f[0].offsetWidth+"px",f.addClass("gantt-task-infoArrowR")):(e.css.left=a-20+"px",f.addClass("gantt-task-infoArrow"))},m=function(){e.css.opacity=0,e.visible=!1}}]}}]),gantt.factory("debounce",["$timeout",function(a){function b(b,c){var d=0;return function(){var e=this,f=arguments;d++;var g=function(a){return function(){return a===d?b.apply(e,f):void 0}}(d);return a(g,c,!0)}}return b}]),gantt.factory("keepScrollPos",["$timeout","Gantt",function(a,b){function c(c,d){return function(){var e=c.ganttScroll[0],f=e.scrollLeft,g=b.getFirstColumn(),h=c.getPxToEmFactor();d.apply(this,arguments),g=void 0===g?0:b.getColumnByDate(g.date).left*h,e.scrollLeft=g+f,e.scrollLeft!=g+f&&a(function(){e.scrollLeft=g+f},0,!1)}}return c}]),gantt.service("mouseButton",[function(){return{getButton:function(a){return a=a||window.event,a.which?a.which:a.button<2?1:4==a.button?2:3}}}]),gantt.service("mouseOffset",[function(){return{getOffset:function(a){return a.offsetX&&a.offsetY?{x:a.offsetX,y:a.offsetY}:a.layerX&&a.layerY?{x:a.layerX,y:a.layerY}:this.getOffsetForElement(a.target,a)},getOffsetForElement:function(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}}}]),gantt.factory("smartEvent",[function(){function a(a,b,c,d){return a.$on("$destroy",function(){b.unbind(c,d)}),{bindOnce:function(){b.one(c,d)},bind:function(){b.bind(c,d)},unbind:function(){b.unbind(c,d)}}}return a}]);