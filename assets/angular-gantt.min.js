var gantt=angular.module("gantt",[]);gantt.directive("gantt",["Gantt","dateFunctions","mouseOffset","debounce","keepScrollPos",function(e,t,n,r,i){return{restrict:"EA",replace:true,templateUrl:function(e,t){if(t.templateUrl===undefined){return"template/gantt.tmpl.html"}else{return t.templateUrl}},scope:{sortMode:"=?",viewScale:"=?",columnWidth:"=?",columnSubScale:"=?",allowTaskMoving:"=?",allowTaskResizing:"=?",allowTaskRowSwitching:"=?",allowRowSorting:"=?",fromDate:"=?",toDate:"=?",firstDayOfWeek:"=?",weekendDays:"=?",showWeekends:"=?",workHours:"=?",showNonWorkHours:"=?",autoExpand:"=?",maxHeight:"=?",labelsWidth:"=?",data:"=?",loadData:"&",removeData:"&",clearData:"&",centerDate:"&",onLabelsResized:"&",onGanttReady:"&",onRowAdded:"&",onRowClicked:"&",onRowUpdated:"&",onScroll:"&",onTaskClicked:"&",onTaskUpdated:"&"},controller:["$scope","$element",function(s,o){if(s.sortMode===undefined)s.sortMode="name";if(s.viewScale===undefined)s.viewScale="day";if(s.columnWidth===undefined)s.columnWidth=2;if(s.columnSubScale===undefined)s.columnSubScale=4;if(s.allowTaskMoving===undefined)s.allowTaskMoving=true;if(s.allowTaskResizing===undefined)s.allowTaskResizing=true;if(s.allowTaskRowSwitching===undefined)s.allowTaskRowSwitching=true;if(s.allowRowSorting===undefined)s.allowRowSorting=true;if(s.firstDayOfWeek===undefined)s.firstDayOfWeek=1;if(s.weekendDays===undefined)s.weekendDays=[0,6];if(s.showWeekends===undefined)s.showWeekends=true;if(s.workHours===undefined)s.workHours=[8,9,10,11,12,13,14,15,16];if(s.showNonWorkHours===undefined)s.showNonWorkHours=true;if(s.maxHeight===undefined)s.maxHeight=0;if(s.autoExpand===undefined)s.autoExpand=false;if(s.labelsWidth===undefined)s.labelsWidth=0;s.gantt=new e(s.viewScale,s.columnWidth,s.columnSubScale,s.firstDayOfWeek,s.weekendDays,s.showWeekends,s.workHours,s.showNonWorkHours);s.gantt.expandDefaultDateRange(s.fromDate,s.toDate);s.ganttScroll=angular.element(o.children()[2]);s.$watch("sortMode",function(e,t){if(!angular.equals(e,t)){s.sortRows()}});s.$watch("data",function(e,t){if(!angular.equals(e,t)){s.removeAllData();s.setData(e)}});s.$watch("viewScale+columnWidth+columnSubScale+fromDate+toDate+firstDayOfWeek+weekendDays+showWeekends+workHours+showNonWorkHours",function(e,t){if(!angular.equals(e,t)){s.gantt.setViewScale(s.viewScale,s.columnWidth,s.columnSubScale,s.firstDayOfWeek,s.weekendDays,s.showWeekends,s.workHours,s.showNonWorkHours);s.gantt.reGenerateColumns()}});s.$watch("fromDate+toDate",function(e,t){if(!angular.equals(e,t)){s.gantt.expandDefaultDateRange(s.fromDate,s.toDate)}});s.getPxToEmFactor=function(){return s.ganttScroll.children()[0].offsetWidth/s.gantt.width};s.swapRows=function(e,t){s.gantt.swapRows(e,t);s.raiseRowUpdatedEvent(e,true);s.raiseRowUpdatedEvent(t,true);if(s.sortMode!=="custom"){s.sortMode="custom"}else{s.sortRows()}};s.sortRows=function(){s.gantt.sortRows(s.sortMode)};s.scrollTo=function(e){s.ganttScroll[0].scrollLeft=e;s.ganttScroll.triggerHandler("scroll")};s.scrollLeft=function(e){s.ganttScroll[0].scrollLeft-=e;s.ganttScroll.triggerHandler("scroll")};s.scrollRight=function(e){s.ganttScroll[0].scrollLeft+=e;s.ganttScroll.triggerHandler("scroll")};s.scrollToDate=function(e){var t=s.gantt.getColumnByDate(e);if(t!==undefined){var n=(t.left+t.width/2)*s.getPxToEmFactor();s.ganttScroll[0].scrollLeft=n-s.ganttScroll[0].offsetWidth/2}};s.autoExpandColumns=i(s,function(e,n,r){if(s.autoExpand!==true){return}var i,o;var u=1,a=31;if(r==="left"){i=s.viewScale==="hour"?t.addDays(n,-u,true):t.addDays(n,-a,true);o=n}else{i=n;o=s.viewScale==="hour"?t.addDays(n,u,true):t.addDays(n,a,true)}s.gantt.expandDefaultDateRange(i,o)});s.raiseLabelsResized=function(e){s.onLabelsResized({event:{width:e}})};s.raiseRowAddedEvent=function(e,t){s.onRowAdded({event:{row:e,userTriggered:t}})};s.raiseDOMRowClickedEvent=function(e,t){var r=n.getOffset(e).x;var i=r/s.getPxToEmFactor();var o=s.gantt.getColumnByPosition(i);var u=s.gantt.getDateByPosition(i);s.raiseRowClickedEvent(t,o,u);e.stopPropagation();e.preventDefault()};s.raiseRowClickedEvent=function(e,t,n){s.onRowClicked({event:{row:e,column:t.clone(),date:n,userTriggered:true}})};s.raiseRowUpdatedEvent=function(e,t){s.onRowUpdated({event:{row:e,userTriggered:t}})};s.raiseScrollEvent=r(function(){var e=s.ganttScroll[0];var t;var n;if(e.scrollLeft===0){t="left";n=s.gantt.getDateRange().from}else if(e.offsetWidth+e.scrollLeft>=e.scrollWidth){t="right";n=s.gantt.getDateRange().to}if(n!==undefined){s.autoExpandColumns(e,n,t);s.onScroll({event:{date:n,direction:t,userTriggered:true}})}},5);s.raiseDOMTaskClickedEvent=function(e,t){s.raiseTaskClickedEvent(t);e.stopPropagation();e.preventDefault()};s.raiseTaskClickedEvent=function(e){s.onTaskClicked({event:{task:e,userTriggered:true}})};s.raiseTaskUpdatedEvent=function(e,t){s.onTaskUpdated({event:{task:e,userTriggered:t}})};s.setData=i(s,function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];var i=s.gantt.addRow(r);var o=s.gantt.rowsMap[r.id];if(i===true){s.raiseRowUpdatedEvent(o,false)}else{s.raiseRowAddedEvent(o,false)}}s.sortRows()});s.removeData({fn:function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];if(r.tasks!==undefined&&r.tasks.length>0){if(r.id in s.gantt.rowsMap){var i=s.gantt.rowsMap[r.id];for(var o=0,u=r.tasks.length;o<u;o++){i.removeTask(r.tasks[o].id)}s.raiseRowUpdatedEvent(i,false)}}else{s.gantt.removeRow(r.id)}}s.sortRows()}});s.removeAllData=function(){s.gantt.removeRows()};s.ganttScroll.bind("scroll",s.raiseScrollEvent);s.loadData({fn:s.setData});s.clearData({fn:s.removeAllData});s.centerDate({fn:s.scrollToDate});s.onGanttReady()}]}}]);gantt.factory("Column",["dateFunctions",function(e){var t=function(e,t,n){return Math.round(t/e.width*n/(t/e.subScale))*(t/e.subScale)};var n=function(e,t,n,r,i,s){var o;if(t-e.date>0&&i!==s){o=1}else{o=Math.round(r/n*e.subScale)/e.subScale}return Math.round((e.left+e.width*o)*10)/10};var r=function(e,t,n,i){var s=this;s.date=e;s.left=t;s.width=n;s.subScale=i;s.clone=function(){return new r(s.date,s.left,s.width,s.subScale)};s.equals=function(e){return s.date===e.date}};var i=function(i,s,o,u){var a=new r(i,s,o,u);a.daysInMonth=e.getDaysInMonth(a.date);a.clone=function(){return new r(a.date,a.left,a.width,a.subScale)};a.getDateByPosition=function(n){if(n<0)n=0;if(n>a.width)n=a.width;var r=e.clone(a.date);r.setDate(1+t(a,a.daysInMonth,n));return r};a.getPositionByDate=function(e){return n(a,e,a.daysInMonth,e.getDate(),e.getMonth(),a.date.getMonth())};return a};var s=function(i,s,o,u,a){var f=new r(i,s,o,u);f.week=e.getWeek(i);f.firstDayOfWeek=a;f.daysInWeek=7;f.clone=function(){var e=new r(f.date,f.left,f.width,f.subScale);e.week=f.week;return e};var l=function(e){return(f.daysInWeek-f.firstDayOfWeek+e)%f.daysInWeek};var c=function(e){return(f.firstDayOfWeek+e)%f.daysInWeek};f.getDateByPosition=function(n){if(n<0)n=0;if(n>f.width)n=f.width;var r=e.clone(f.date);var i=Math.round(t(f,f.daysInWeek,n));var s=i!==7&&i<f.firstDayOfWeek?-1:1;e.setToDayOfWeek(r,i!==7?c(i):c(i)+7,false,s);return r};f.getPositionByDate=function(t){return n(f,t,f.daysInWeek,l(t.getDay()),e.getWeek(t),e.getWeek(f.date))};return f};var o=function(i,s,o,u,a){var f=new r(i,s,o,u);f.isWeekend=a;f.clone=function(){var e=new r(f.date,f.left,f.width,f.subScale);e.isWeekend=f.isWeekend;return e};f.getDateByPosition=function(n){if(n<0)n=0;if(n>f.width)n=f.width;var r=e.clone(f.date);r.setHours(t(f,24,n));return r};f.getPositionByDate=function(e){return n(f,e,24,e.getHours(),e.getDate(),f.date.getDate())};return f};var u=function(i,s,o,u,a,f){var l=new r(i,s,o,u);l.isWeekend=a;l.isWorkHour=f;l.clone=function(){var e=new r(l.date,l.left,l.width,l.subScale);e.isWeekend=l.isWeekend;e.isWorkHour=l.isWorkHour;return e};l.getDateByPosition=function(n){if(n<0)n=0;if(n>l.width)n=l.width;var r=e.clone(l.date);r.setMinutes(t(l,60,n));return r};l.getPositionByDate=function(e){return n(l,e,60,e.getMinutes(),e.getHours(),l.date.getHours())};return l};return{Hour:u,Day:o,Week:s,Month:i}}]);gantt.factory("ColumnGenerator",["Column","dateFunctions",function(e,t){var n=function(e,t){for(var n=0,r=e.length;n<r;n++){if(e[n]===t){return true}}return false};var r=function(e,t){for(var n=0,r=e.length;n<r;n++){if(e[n]===t){return true}}return false};var i=function(i,s,o,u,a,f){this.generate=function(l,c){var h=t.isTimeZero(c);l=t.setTimeZero(l,true);c=t.setTimeZero(c,true);var p=t.clone(l);var d=[];var v=0;while(h&&c-p>0||!h&&c-p>=0){var m=n(o,p.getDay());for(var g=0;g<24;g++){var y=new Date(p.getFullYear(),p.getMonth(),p.getDate(),g,0,0);var b=r(a,g);if((m&&u||!m)&&(!b&&f||b)){d.push(new e.Hour(y,v,i,s,m,b));v+=i}}p=t.addDays(p,1)}return d}};var s=function(r,i,s,o){this.generate=function(u,a){var f=t.isTimeZero(a);u=t.setTimeZero(u,true);a=t.setTimeZero(a,true);var l=t.clone(u);var c=[];var h=0;while(f&&a-l>0||!f&&a-l>=0){var p=n(s,l.getDay());if(p&&o||!p){c.push(new e.Day(t.clone(l),h,r,i,p));h+=r}l=t.addDays(l,1)}return c}};var o=function(n,r,i){this.generate=function(s,o){var u=o.getDay()===i&&t.isTimeZero(o);s=t.setToDayOfWeek(t.setTimeZero(s,true),i,false);o=t.setToDayOfWeek(t.setTimeZero(o,true),i,false);var a=t.clone(s);var f=[];var l=0;while(u&&o-a>0||!u&&o-a>=0){f.push(new e.Week(t.clone(a),l,n,r,i));l+=n;a=t.addWeeks(a,1)}return f}};var u=function(n,r){this.generate=function(i,s){var o=s.getDate()===1&&t.isTimeZero(s);i=t.setToFirstDayOfMonth(t.setTimeZero(i,true),false);s=t.setToFirstDayOfMonth(t.setTimeZero(s,true),false);var u=t.clone(i);var a=[];var f=0;while(o&&s-u>0||!o&&s-u>=0){a.push(new e.Month(t.clone(u),f,n,r));f+=n;u=t.addMonths(u,1)}return a}};return{HourGenerator:i,DayGenerator:s,WeekGenerator:o,MonthGenerator:u}}]);gantt.factory("Gantt",["Row","ColumnGenerator","HeaderGenerator","dateFunctions","binarySearch",function(e,t,n,r,i){var s=function(s,o,u,a,f,l,c,h){var p=this;p.rowsMap={};p.rows=[];p.columns=[];p.headers={};p.width=0;var d;p.setViewScale=function(e,r,i,s,o,u,a,f){switch(e){case"hour":p.columnGenerator=new t.HourGenerator(r,i,o,u,a,f);break;case"day":p.columnGenerator=new t.DayGenerator(r,i,o,u);break;case"week":p.columnGenerator=new t.WeekGenerator(r,i,s);break;case"month":p.columnGenerator=new t.MonthGenerator(r,i);break;default:throw"Unsupported view scale: "+e}p.headerGenerator=new n.instance(e)};p.setViewScale(s,o,u,a,f,l,c,h);p.expandDefaultDateRange=function(e,t){if(e!==undefined&&t!==undefined){v(e,t);m()}};var v=function(e,t){e=r.clone(e);t=r.clone(t);if(d===undefined){d={};d.from=e;d.to=t}else{if(e<d.from){d.from=e}if(t>d.to){d.to=t}}};var m=function(){if(d===undefined){throw"From and to date range cannot be undefined"}if(p.columns.length===0){g(d.from,d.to)}else if(p.getFirstColumn().date>d.from||p.getLastColumn().date<d.to){var e=p.getFirstColumn().date>d.from?d.from:p.getFirstColumn().date;var t=p.getLastColumn().date<d.to?d.to:p.getLastColumn().date;g(e,t)}};var g=function(e,t){p.columns=p.columnGenerator.generate(e,t);p.headers=p.headerGenerator.generate(p.columns);p.updateTasksPosAndSize();var n=p.getLastColumn();p.width=n!==undefined?n.left+n.width:0};p.reGenerateColumns=function(){p.columns=[];m()};p.updateTasksPosAndSize=function(){for(var e=0,t=p.rows.length;e<t;e++){for(var n=0,r=p.rows[e].tasks.length;n<r;n++){p.rows[e].tasks[n].updatePosAndSize()}}};p.getLastColumn=function(){if(p.columns.length>0){return p.columns[p.columns.length-1]}else{return undefined}};p.getFirstColumn=function(){if(p.columns.length>0){return p.columns[0]}else{return undefined}};p.getColumnByDate=function(e){return i.get(p.columns,e,function(e){return e.date})[0]};p.getColumnByPosition=function(e){return i.get(p.columns,e,function(e){return e.left})[0]};p.getDateByPosition=function(e){var t=p.getColumnByPosition(e);if(t!==undefined){return t.getDateByPosition(e-t.left)}else{return undefined}};p.getPositionByDate=function(e){var t=p.getColumnByDate(e);if(t!==undefined){return t.getPositionByDate(e)}else{return undefined}};p.getDateRange=function(){if(d===undefined){return undefined}else{return{from:r.clone(d.from),to:r.clone(d.to)}}};p.getTasksDateRange=function(){if(p.rows.length===0){return undefined}else{var e,t;for(var n=0,r=p.rows.length;n<r;n++){var i=p.rows[n];if(e===undefined||i.minFromDate<e){e=i.minFromDate}if(t===undefined||i.maxToDate>t){t=i.maxToDate}}return{from:e,to:t}}};p.getActiveHeadersCount=function(){var e=0,t;for(t in p.headers){if(p.headers.hasOwnProperty(t))e++}return e};p.addRow=function(t){var n,r=false;if(t.id in p.rowsMap){n=p.rowsMap[t.id];n.copy(t);r=true}else{var i=t.order;if(i===undefined){i=p.highestRowOrder}if(i>=p.highestRowOrder){p.highestRowOrder=i+1}n=new e(t.id,p,t.description,i,t.data);p.rowsMap[t.id]=n;p.rows.push(n)}if(t.tasks!==undefined){for(var s=0,o=t.tasks.length;s<o;s++){var u=n.addTask(t.tasks[s]);v(u.from,u.to);u.updatePosAndSize()}m()}return r};p.removeRow=function(e){if(e in p.rowsMap){delete p.rowsMap[e];for(var t=0,n=p.rows.length;t<n;t++){var r=p.rows[t];if(r.id===e){p.rows.splice(t,1);return r}}}return undefined};p.removeRows=function(){p.rowsMap={};p.rows=[];p.highestRowOrder=0;p.columns=[];d=undefined};p.swapRows=function(e,t){var n=e.order;e.order=t.order;t.order=n};var y=function(e,t){if(e.minFromDate===undefined&&t.minFromDate===undefined){return b(e,t)}else if(e.minFromDate===undefined){return 1}else if(t.minFromDate===undefined){return-1}else{return e.minFromDate-t.minFromDate}};var b=function(e,t){if(e.description===t.description){return 0}else{return e.description<t.description?-1:1}};var w=function(e,t){if(e.order===undefined&&t.order===undefined){return b(e,t)}else if(e.order===undefined){return 1}else if(t.order===undefined){return-1}else{return e.order-t.order}};p.sortRows=function(e){switch(e){case"name":p.rows.sort(b);break;case"custom":p.rows.sort(w);break;default:p.rows.sort(y);break}}};return s}]);gantt.factory("HeaderGenerator",["Column","dateFunctions",function(e,t){var n=function(n){var r=[];var i;for(var s=0,o=n.length;s<o;s++){var u=n[s];if(s===0||n[s-1].date.getHours()!==u.date.getHours()){i=new e.Hour(t.clone(u.date),u.left,u.width,u.isWeekend,u.isWorkHour);r.push(i)}else{i.width+=u.width}}return r};var r=function(n){var r=[];var i;for(var s=0,o=n.length;s<o;s++){var u=n[s];if(s===0||n[s-1].date.getDay()!==u.date.getDay()){i=new e.Day(t.clone(u.date),u.left,u.width,u.isWeekend);r.push(i)}else{i.width+=u.width}}return r};var i=function(n){var r=[];var i;for(var s=0,o=n.length;s<o;s++){var u=n[s];if(s===0||t.getWeek(n[s-1].date)!==t.getWeek(u.date)){i=new e.Week(t.clone(u.date),u.left,u.width,t.getWeek(u.date));r.push(i)}else{i.width+=u.width}}return r};var s=function(n){var r=[];var i;for(var s=0,o=n.length;s<o;s++){var u=n[s];if(s===0||n[s-1].date.getMonth()!==u.date.getMonth()){i=new e.Month(t.clone(u.date),u.left,u.width);r.push(i)}else{i.width+=u.width}}return r};return{instance:function(e){this.generate=function(t){var o={};switch(e){case"hour":o.hour=n(t);o.day=r(t);break;case"day":o.day=r(t);o.week=i(t);o.month=s(t);break;case"week":o.week=i(t);o.month=s(t);break;case"month":o.month=s(t);break;default:throw"Unsupported view scale: "+e}return o}}}}]);gantt.factory("Row",["Task","dateFunctions",function(e,t){var n=function(r,i,s,o,u){var a=this;a.id=r;a.gantt=i;a.description=s;a.order=o;a.tasksMap={};a.tasks=[];a.data=u;a.addTask=function(t){var n;if(t.id in a.tasksMap){n=a.tasksMap[t.id];n.copy(t)}else{n=new e(t.id,a,t.subject,t.classes,t.priority,t.from,t.to,t.data);a.tasksMap[t.id]=n;a.tasks.push(n)}a.sortTasks();a.setMinMaxDateByTask(n);return n};a.moveTaskToRow=function(e){e.row.removeTask(e.id);a.tasksMap[e.id]=e;a.tasks.push(e);a.setTasksMinMaxDate();e.row=a;e.updatePosAndSize()};a.removeTask=function(e){if(e in a.tasksMap){delete a.tasksMap[e];for(var t=0,n=a.tasks.length;t<n;t++){var r=a.tasks[t];if(r.id===e){a.tasks.splice(t,1);if(a.minFromDate-r.from===0||a.maxToDate-r.to===0){a.setTasksMinMaxDate()}return r}}}};a.setTasksMinMaxDate=function(){a.minFromDate=undefined;a.maxToDate=undefined;for(var e=0,t=a.tasks.length;e<t;e++){a.setMinMaxDateByTask(a.tasks[e])}};a.setMinMaxDateByTask=function(e){if(a.minFromDate===undefined){a.minFromDate=t.clone(e.from)}else if(e.from<a.minFromDate){a.minFromDate=t.clone(e.from)}if(a.maxToDate===undefined){a.maxToDate=t.clone(e.to)}else if(e.to>a.maxToDate){a.maxToDate=t.clone(e.to)}};a.sortTasks=function(){a.tasks.sort(function(e,t){return e.left-t.left})};a.copy=function(e){a.description=e.description;a.data=e.data;if(e.order!==undefined){a.order=e.order}};a.clone=function(){var e=new n(a.id,a.gantt,a.description,a.order,a.data);for(var t=0,r=a.tasks.length;t<r;t++){e.addTask(a.tasks[t].clone())}return e}};return n}]);gantt.factory("Task",["dateFunctions",function(e){var t=function(n,r,i,s,o,u,a,f){var l=this;l.id=n;l.gantt=r.gantt;l.row=r;l.subject=i;l.classes=s;l.priority=o;l.from=e.clone(u);l.to=e.clone(a);l.data=f;l.checkIfMilestone=function(){l.isMilestone=l.from-l.to===0};l.checkIfMilestone();l.updatePosAndSize=function(){l.left=l.gantt.getPositionByDate(l.from);l.width=Math.round((l.gantt.getPositionByDate(l.to)-l.left)*10)/10};l.setFrom=function(e){if(e>l.left+l.width){e=l.left+l.width}else if(e<0){e=0}l.from=l.gantt.getDateByPosition(e);l.row.setMinMaxDateByTask(l);l.updatePosAndSize();l.checkIfMilestone()};l.setTo=function(e){if(e<l.left){e=l.left}else if(e>l.gantt.width){e=l.gantt.width}l.to=l.gantt.getDateByPosition(e);l.row.setMinMaxDateByTask(l);l.updatePosAndSize();l.checkIfMilestone()};l.moveTo=function(e){if(e<0){e=0}else if(e+l.width>=l.gantt.width){e=l.gantt.width-l.width}l.from=l.gantt.getDateByPosition(e);l.left=l.gantt.getPositionByDate(l.from);l.to=l.gantt.getDateByPosition(l.left+l.width);l.width=Math.round((l.gantt.getPositionByDate(l.to)-l.left)*10)/10;l.row.setMinMaxDateByTask(l)};l.copy=function(t){l.subject=t.subject;l.classes=t.classes;l.priority=t.priority;l.from=e.clone(t.from);l.to=e.clone(t.to);l.data=t.data;l.isMilestone=t.isMilestone};l.clone=function(){return new t(l.id,l.row,l.subject,l.classes,l.priority,l.from,l.to,l.data)}};return t}]);gantt.service("binarySearch",[function(){return{getIndicesOnly:function(e,t,n){var r=-1,i=e.length;while(i-r>1){var s=Math.floor((r+i)/2);if(n(e[s])<=t){r=s}else{i=s}}if(e[r]!==undefined&&n(e[r])===t)i=r;return[r,i]},get:function(e,t,n){var r=this.getIndicesOnly(e,t,n);return[e[r[0]],e[r[1]]]}}}]);gantt.service("dateFunctions",[function(){return{isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isString:function(e){return typeof e=="string"||typeof e=="object"&&e.constructor===String},clone:function(e){if(this.isString(e)){return new Date(Date.parse(e))}else if(this.isNumber(e)){return new Date(e)}else{return new Date(e.getTime())}},setTimeZero:function(e,t){var n=t===true?this.clone(e):e;n.setHours(0);n.setMinutes(0);n.setMilliseconds(0);return n},setTimeComponent:function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,t)},setToFirstDayOfMonth:function(e,t){var n=t===true?this.clone(e):e;n.setDate(1);return n},setToDayOfWeek:function(e,t,n,r){var i=n===true?this.clone(e):e;if(i.getDay()===t){return i}else{r=r||-1;var s=(t-i.getDay()+7*(r||+1))%7;return this.addDays(i,s===0?s+=7*(r||+1):s)}},addMonths:function(e,t,n){var r=n===true?this.clone(e):e;r.setDate(1);r.setMonth(r.getMonth()+t);return r},addWeeks:function(e,t,n){var r=n===true?this.clone(e):e;r.setDate(r.getDate()+t*7);return r},addDays:function(e,t,n){var r=n===true?this.clone(e):e;r.setDate(r.getDate()+t);return r},addHours:function(e,t,n){var r=n===true?this.clone(e):e;r.setHours(r.getHours()+t);return r},addMinutes:function(e,t,n){var r=n===true?this.clone(e):e;r.setMinutes(r.getMinutes()+t);return r},addMilliseconds:function(e,t,n){var r=n===true?this.clone(e):e;r.setMilliseconds(r.getMilliseconds()+t);return r},isTimeZero:function(e){return e.getHours()===0&&e.getMinutes()===0&&e.getMinutes()===0&&e.getMilliseconds()===0},getDaysInMonth:function(e){return(new Date(e.getYear(),e.getMonth()+1,0)).getDate()},getWeek:function(e){var t,n,r;var i,s,o,u,a,f,l,c,h,p;t=e.getFullYear();n=e.getMonth()+1;r=e.getDate();if(n<=2){i=t-1;s=(i/4|0)-(i/100|0)+(i/400|0);o=((i-1)/4|0)-((i-1)/100|0)+((i-1)/400|0);h=s-o;a=0;f=r-1+31*(n-1)}else{i=t;s=(i/4|0)-(i/100|0)+(i/400|0);o=((i-1)/4|0)-((i-1)/100|0)+((i-1)/400|0);h=s-o;a=h+1;f=r+(153*(n-3)+2)/5+58+h}l=(i+s)%7;u=(f+l-a)%7;c=f+3-u|0;if(c<0){p=53-((l-h)/5|0)}else if(c>364+h){p=1}else{p=(c/7|0)+1}t=n=r=null;return p}}}]);gantt.filter("ganttColumnLimit",["binarySearch",function(e){return function(t,n,r){var i=function(e){return e.left};var s=e.getIndicesOnly(t,n,i)[0];var o=e.getIndicesOnly(t,n+r,i)[1];return t.slice(s,o)}}]);gantt.directive("ganttLimitUpdater",["$timeout",function(e){return{restrict:"A",controller:["$scope","$element",function(t,n){var r=n[0];var i=function(){t.scroll_start=r.scrollLeft/t.getPxToEmFactor();t.scroll_width=r.offsetWidth/t.getPxToEmFactor()};n.bind("scroll",function(){t.$apply(function(){i()})});t.$watch("gantt.width",function(t,n){e(function(){i()},20,true)})}]}}]);gantt.filter("ganttTaskLimit",[function(){return function(e,t,n){var r=[];for(var i=0,s=e.length;i<s;i++){var o=e[i];if(o.left>=t&&o.left<=t+n||o.left+o.width>=t&&o.left+o.width<=t+n||o.left<t&&o.left+o.width>t+n){r.push(o)}}return r}}]);gantt.directive("ganttLabelResizable",["$document","debounce","mouseOffset",function(e,t,n){return{restrict:"A",scope:{width:"=ganttLabelResizable",minWidth:"=ganttLabelResizeMin",onResized:"&onLabelResized"},controller:["$scope","$element",function(r,i){var s=5;var o="ew-resize";var u;i.bind("mousedown",function(e){if(f(e)){l(e);e.preventDefault()}});i.bind("mousemove",function(e){if(f(e)){i.css("cursor",o)}else{i.css("cursor","")}});var a=function(e){if(r.width===0){r.width=i[0].offsetWidth}r.width+=e-u;if(r.width<r.minWidth){r.width=r.minWidth}u=e};var f=function(e){var t=n.getOffset(e).x;return t>i[0].offsetWidth-s};var l=function(n){u=n.screenX;angular.element(e[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:o});var r=t(function(e){a(e.screenX)},5);angular.element(e[0].body).bind("mousemove",r);angular.element(e[0].body).one("mouseup",function(){angular.element(e[0].body).unbind("mousemove",r);c()})};var c=function(){i.css("cursor","");angular.element(e[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""});r.onResized({width:r.width})}}]}}]);gantt.directive("ganttTaskMoveable",["$document","$timeout","debounce","dateFunctions","mouseOffset",function(e,t,n,r,i){return{restrict:"A",controller:["$scope","$element",function(r,s){var o=5;var u=3;var a=15;var f=1;var l=angular.element(e[0].body);var c=s.parent().parent();var h=c.parent().parent();var p=false;var d;var v;var m;s.bind("mousedown",function(e){var t=S(e);if(t!==""){T(t,e);e.preventDefault()}});s.bind("mousemove",function(e){var t=S(e);if(t!==""&&t!=="M"){s.css("cursor",x(t))}else{s.css("cursor","")}});var g=function(e,t){if(r.task.isMoving===false){return}y(e,t);b(e,t)};var y=function(e,t){var n=t.x/r.getPxToEmFactor();if(e==="M"){if(r.allowTaskRowSwitching){var i=E(t.y);if(i!==undefined&&r.task.row.id!==i.id){i.moveTaskToRow(r.task)}}if(r.allowTaskMoving){r.task.moveTo(n-d)}}else if(e==="E"){r.task.setTo(n)}else{r.task.setFrom(n)}p=true};var b=function(e,n){var i=h[0].scrollLeft;if(n.x<v){if(n.x<=i+f){n.x-=a;r.scrollLeft(a);m=t(function(){g(e,n)},100,true)}}else{var s=h[0].offsetWidth;var o=i+s;if(n.x>=o-f){n.x+=a;r.scrollRight(a);m=t(function(){g(e,n)},100,true)}}};var w=function(){if(m!==undefined){t.cancel(m);m=undefined}};var E=function(e){var t=c[0].offsetHeight/r.task.row.gantt.rows.length;var n=Math.floor(e/t);return r.task.row.gantt.rows[n]};var S=function(e){var t=i.getOffset(e).x;var n=0;if(r.allowTaskResizing){n=s[0].offsetWidth<10?u:o}if(r.allowTaskResizing&&t>s[0].offsetWidth-n){return"E"}else if(r.allowTaskResizing&&t<n){return"W"}else if((r.allowTaskMoving||r.allowTaskRowSwitching)&&t>=n&&t<=s[0].offsetWidth-n){return"M"}else{return""}};var x=function(e){switch(e){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}};var T=function(t,s){r.task.isMoving=true;v=i.getOffsetForElement(c[0],s).x;var o=v/r.getPxToEmFactor();d=o-r.task.left;angular.element(e[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:x(t)});var u=n(function(e){var n=i.getOffsetForElement(c[0],e);w();g(t,n)},5);l.bind("mousemove",u);l.one("mouseup",function(){l.unbind("mousemove",u);N()})};var N=function(){r.task.isMoving=false;w();s.css("cursor","");angular.element(e[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""});if(p===true){r.task.row.sortTasks();r.raiseTaskUpdatedEvent(r.task,true);p=false}}}]}}]);gantt.directive("ganttHorizontalScrollReceiver",["scrollManager",function(e){return{restrict:"A",controller:["$scope","$element",function(t,n){e.horizontal.push(n[0])}]}}]);gantt.service("scrollManager",[function(){return{vertical:[],horizontal:[]}}]);gantt.directive("ganttScrollSender",["scrollManager","$timeout",function(e,t){return{restrict:"A",controller:["$scope","$element",function(n,r){var i=r[0];var s=function(){var t,n;for(t=0,n=e.vertical.length;t<n;t++){var r=e.vertical[t];if(r.style.top!==-i.scrollTop)r.style.top=-i.scrollTop+"px"}for(t=0,n=e.horizontal.length;t<n;t++){var s=e.horizontal[t];if(s.style.left!==-i.scrollLeft)s.style.left=-i.scrollLeft+"px"}};r.bind("scroll",s);n.$watch("gantt.width",function(e,n){if(e===0){t(function(){s()},20,true)}})}]}}]);gantt.directive("ganttVerticalScrollReceiver",["scrollManager",function(e){return{restrict:"A",controller:["$scope","$element",function(t,n){e.vertical.push(n[0])}]}}]);gantt.service("sortManager",[function(){return{startRow:undefined}}]);gantt.directive("ganttSortable",["$document","sortManager",function(e,t){return{restrict:"E",template:"<div ng-transclude></div>",replace:true,transclude:true,scope:{row:"=ngModel",swap:"&",active:"=?"},controller:["$scope","$element",function(n,r){r.bind("mousedown",function(){if(n.active!==true){return}s();var t=function(){n.$apply(function(){angular.element(e[0].body).unbind("mouseup",t);o()})};angular.element(e[0].body).bind("mouseup",t)});r.bind("mousemove",function(r){if(i()){var s=angular.element(e[0].elementFromPoint(r.clientX,r.clientY));var o=s.controller("ngModel").$modelValue;n.$apply(function(){n.swap({a:o,b:t.startRow})})}});var i=function(){return t.startRow!==undefined&&!angular.equals(n.row,t.startRow)};var s=function(){t.startRow=n.row;r.css("cursor","move");angular.element(e[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"no-drop"})};var o=function(){t.startRow=undefined;r.css("cursor","pointer");angular.element(e[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:"auto"})}}]}}]);gantt.directive("ganttTooltip",["$timeout","$document","debounce","smartEvent",function(e,t,n,r){return{restrict:"E",template:"<div ng-mouseenter='mouseEnter($event)' ng-mouseleave='mouseLeave($event)'>"+"<div ng-if='visible' class='gantt-task-info' ng-style='css'>"+"<div class='gantt-task-info-content'>"+"{{ task.subject }}</br>"+"<small>"+"{{ task.isMilestone === true &&"+" (task.from | date:'MMM d, HH:mm') ||"+" (task.from | date:'MMM d, HH:mm') + ' - ' + (task.to | date:'MMM d, HH:mm') }}"+"</small>"+"</div>"+"</div>"+"<div ng-transclude></div>"+"</div>",replace:true,transclude:true,scope:{task:"=ngModel"},controller:["$scope","$element",function(i,s){var o=angular.element(t[0].body);i.visible=false;i.css={};i.mouseEnter=function(e){if(!i.task.isMoving){f(e.clientX)}};i.mouseLeave=function(e){if(!i.task.isMoving){c()}};var u=r(i,o,"mousemove",n(function(e){if(i.visible===true){l(e.clientX)}else{f(e.clientX)}},1));i.$watch("task.isMoving",function(e,t){if(e===true){u.bind()}else if(e===false){u.unbind();c()}});var a=function(){var e=t[0];return e.documentElement.clientWidth||e.documentElement.getElementById("body")[0].clientWidth};var f=function(t){i.visible=true;e(function(){var e=angular.element(s.children()[0]);l(t);i.css.top=s[0].getBoundingClientRect().top+"px";i.css.marginTop=-e[0].offsetHeight-8+"px";i.css.opacity=1},1,true)};var l=function(e){var t=angular.element(s.children()[0]);t.removeClass("gantt-task-infoArrow");t.removeClass("gantt-task-infoArrowR");if(e+t[0].offsetWidth>a()){i.css.left=e+20-t[0].offsetWidth+"px";t.addClass("gantt-task-infoArrowR")}else{i.css.left=e-20+"px";t.addClass("gantt-task-infoArrow")}};var c=function(){i.css.opacity=0;i.visible=false}}]}}]);gantt.factory("debounce",["$timeout",function(e){function t(t,n){var r=0;return function(){var i=this;var s=arguments;r++;var o=function(e){return function(){if(e===r){return t.apply(i,s)}}}(r);return e(o,n,true)}}return t}]);gantt.factory("keepScrollPos",["$timeout",function(e){function t(t,n){return function(){var r=t.ganttScroll[0];var i=r.scrollLeft;var s=t.gantt.getFirstColumn();var o=t.getPxToEmFactor();n.apply(this,arguments);s=s===undefined?0:t.gantt.getColumnByDate(s.date).left*o;r.scrollLeft=s+i;if(r.scrollLeft!=s+i){e(function(){r.scrollLeft=s+i},0,false)}}}return t}]);gantt.service("mouseOffset",[function(){return{getOffset:function(e){if(e.offsetX&&e.offsetY){return{x:e.offsetX,y:e.offsetY}}if(e.layerX&&e.layerY){return{x:e.layerX,y:e.layerY}}else{return this.getOffsetForElement(e.target,e)}},getOffsetForElement:function(e,t){var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}}}]);gantt.factory("smartEvent",[function(){function e(e,t,n,r){e.$on("$destroy",function(){t.unbind(n,r)});return{bindOnce:function(){t.one(n,r)},bind:function(){t.bind(n,r)},unbind:function(){t.unbind(n,r)}}}return e}])